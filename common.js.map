{"version":3,"file":"common.js","sources":["webpack:///._src_api_account_account.ts","webpack:///._src_api_clock_clock.ts","webpack:///._src_api_common_common.ts","webpack:///._src_api_content_content.ts","webpack:///._src_api_mina_app_mina_app.ts","webpack:///._src_api_personal_center_personal_center.ts","webpack:///._src_api_study_length_study_length.ts","webpack:///._src_components_bottom-dialog_bottom-dialog.scss","webpack:///._src_components_bottom-dialog_bottom-dialog.tsx","webpack:///._src_components_dialog_dialog.scss","webpack:///._src_components_dialog_dialog.tsx","webpack:///._src_components_empty_empty.module.scss","webpack:///._src_components_empty_empty.tsx","webpack:///._src_components_family-card_family-card.module.scss","webpack:///._src_components_family-card_family-card.tsx","webpack:///._src_components_follow-remind_follow-remind.tsx","webpack:///._src_components_follow-remind_index.module.scss","webpack:///._src_components_lecture-list_lecture-list.scss","webpack:///._src_components_lecture-list_lecture-list.tsx","webpack:///._src_components_load-more_load-more.module.scss","webpack:///._src_components_load-more_load-more.tsx","webpack:///._src_components_loading_loading.module.scss","webpack:///._src_components_loading_loading.tsx","webpack:///._src_components_navbar_navbar.module.scss","webpack:///._src_components_navbar_navbar.tsx","webpack:///._src_components_player-float_player-float.scss","webpack:///._src_components_player-float_player-float.tsx","webpack:///._src_config_config.ts","webpack:///._src_libs_date-format.js","webpack:///._src_store_common.ts","webpack:///._src_store_index.ts","webpack:///._src_store_player.ts","webpack:///._src_store_user.ts","webpack:///._src_utils_WX.ts","webpack:///._src_utils_bg-music.ts","webpack:///._src_utils_css-module.ts","webpack:///._src_utils_http.ts","webpack:///._src_utils_login.ts","webpack:///._src_utils_storage.ts","webpack:///._src_utils_tools.ts","webpack:///._src_utils_track.ts"],"sourcesContent":["/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-20 16:26:00\r\n * @LastEditTime: 2021-09-17 15:58:14\r\n * @Description:\r\n */\r\nimport { AxiosRequestConfig, get, url, post, http } from '@/utils/http';\r\nimport { IAccount, IUserAccess, IJudgeAccess, IJudgeSubscribe, IShareCard } from './account.i';\r\nimport { configDefault } from '@/config/config';\r\n\r\n/**\r\n * 登录\r\n */\r\nexport function api_weixin_mina_v2(params: IAccount.params) {\r\n  const config: AxiosRequestConfig = {\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },\r\n  };\r\n  // noaccess 无需校验登录态的接口\r\n  const _params = { ...params, noaccess: true };\r\n  return post<IAccount.data>(`${url.wk}/account/auth/weixin_mina_v2`, _params, config);\r\n}\r\n\r\n/** 用户加入 */\r\nexport function api_user_access(params: IUserAccess.Params) {\r\n  return get<IUserAccess.Data>(`${url.base}/access.user_access.get`, {\r\n    object_type: (params && params.object_type) || 'channel',\r\n    object_id: (params && params.object_id) || configDefault.channel_id,\r\n    source: (params && params.source) || 'normal',\r\n  });\r\n}\r\n\r\n/** 用户是否加入 */\r\nexport function api_judge_user_access(params?: Omit<IUserAccess.Params, 'source'>) {\r\n  return get<IJudgeAccess.Data>(`${url.base}/access.judge_user_access.get`, {\r\n    object_type: (params && params.object_type) || 'channel',\r\n    object_id: (params && params.object_id) || configDefault.channel_id,\r\n  });\r\n}\r\n\r\n/** 是否关注公众号 */\r\nexport function api_judge_subscribed(account_id: number) {\r\n  return get<IJudgeSubscribe.Data>(`${url.base}/subscribe.judge_subscribed.get`, {\r\n    account_id,\r\n  });\r\n}\r\n/**\r\n * 是否关注公众号\r\n * NOTE: 这是一个只专注于判断公众号的接口，楼上的那个接口说是有逻辑耦合，目前这个接口应用在首页的订阅消息那块\r\n *\r\n */\r\nexport function api_check_subscribed(account_id: number) {\r\n  return get<IJudgeSubscribe.Data>(`${url.base}/subscribe.check_subscribed.get`, {\r\n    account_id,\r\n  });\r\n}\r\n/** 分享亲友卡 */\r\nexport function api_share_card_count(channel_id: number) {\r\n  return get<IShareCard.Data>(`${url.base}/share.share_card_count.get`, {\r\n    channel_id,\r\n  });\r\n}\r\n","/** 打卡 */\r\nimport { get, url, post } from '@/utils/http';\r\nimport { IClockIn, IClockMinaShareGet, ICreditsGet, IFinishLecture } from './clock.i';\r\n\r\n/**\r\n * 打卡\r\n */\r\nexport function api_clock_in(params: IClockIn.params) {\r\n  if (!params.object_type) params.object_type = 'lecture';\r\n  return get<IClockIn.data>(`${url.base}/clock.clock_in`, params);\r\n}\r\n/**\r\n * 获取分享卡\r\n */\r\nexport function api_clock_mina_share_get(params: IClockMinaShareGet.params) {\r\n  return get<IClockMinaShareGet.data>(`${url.base}/clock.clock_mina_share.get`, params);\r\n}\r\n\r\n/**\r\n * 用户发布笔记获取积分接口\r\n */\r\nexport function api_credits_get(params: ICreditsGet.params) {\r\n  return get<ICreditsGet.data>(`${url.base}/clock.publish_note.credits.get`, params);\r\n}\r\n\r\n/** 用户学完课程获取积分接口 */\r\nexport function api_finish_lecture(lecture_id: number, channel_id: number) {\r\n  return get<IFinishLecture.Data>(`${url.base}/clock.finish_lecture.credits.get`, {\r\n    lecture_id,\r\n    channel_id,\r\n  });\r\n}\r\n/** 分享打卡事件上报 */\r\nexport function api_share_clock() {\r\n  return get<{}>(`${url.base}/clock.share_clock`);\r\n}\r\n","/*\r\n * @Description: file content\r\n * @Date: 2021-09-10 15:54:19\r\n * @LastEditTime: 2021-09-10 16:49:43\r\n */\r\nimport { get, url, post, http } from '@/utils/http';\r\nimport { IBusinessFlag, ITemplateSubscription, ILandingPageRandom } from './common.i';\r\n\r\n// 引导关注公众号、购买转化弹窗\r\nexport function api_business_flag(params: IBusinessFlag.params) {\r\n  return post<IBusinessFlag.Data>(`${url.base}/common.business_flag.post`, params);\r\n}\r\n\r\n/**\r\n * 获取落地页模板\r\n * @param {*} params\r\n */\r\nexport function api_landing_page_random(params: ILandingPageRandom.params) {\r\n  const _params = { ...params, noaccess: true }; // 无需登录态\r\n  return get<ILandingPageRandom.data>(`${url.base}/common.landing_page_random.get`, _params);\r\n}\r\n","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-20 16:26:00\r\n * @LastEditTime: 2021-08-26 16:44:19\r\n * @Description:\r\n */\r\n/** 内容 */\r\nimport { AxiosRequestConfig, get, url, post, http } from '@/utils/http';\r\nimport {\r\n  IChannelDailyContentGet,\r\n  IContentDiscussmessageGet,\r\n  IContentGet,\r\n  IDailyContent,\r\n  ILikeDiscussmessagePost,\r\n  ITodayContent,\r\n  IWriteDiscussmessagePost,\r\n} from './content.i';\r\nimport { configDefault } from '@/config/config';\r\n\r\n/**\r\n * 获取详情信息\r\n */\r\nexport function api_content_get(params: IContentGet.params) {\r\n  return get<IContentGet.data>(`${url.base}/content.content.get`, params);\r\n}\r\n\r\n/**\r\n * 获取详情目录信息\r\n */\r\nexport function api_channel_daily_content_get(params: IChannelDailyContentGet.params) {\r\n  return get<IChannelDailyContentGet.data>(`${url.base}/content.channel_daily_content.get`, params);\r\n}\r\n\r\n/**\r\n * 今日学习内容\r\n */\r\nexport function api_today_content() {\r\n  return get<ITodayContent.Data>(`${url.base}/content.today_content_page.get`);\r\n}\r\n\r\n/** 新用户获取临时数据 无需token */\r\nexport function api_noaccess_content_page() {\r\n  return get<ITodayContent.ChannelInfo>(`${url.base}/content.noaccess_content_page.get`, {\r\n    channel_id: configDefault.channel_id,\r\n    noaccess: true,\r\n  });\r\n}\r\n\r\n/** 请求专栏计划页数据 */\r\nexport function api_channel_daily_content(channel_id: number) {\r\n  return get<IDailyContent.Data>(`${url.base}/content.channel_daily_content.get`, {\r\n    channel_id,\r\n  });\r\n}\r\n\r\n/**\r\n * 获取笔记列\r\n */\r\nexport function api_content_discussmessage_get(params: IContentDiscussmessageGet.params) {\r\n  return get<IContentDiscussmessageGet.data>(`${url.base}/content.content_discussmessage.get`, params);\r\n}\r\n/**\r\n * 发表笔记\r\n */\r\nexport function api_write_discussmessage_post(params: IWriteDiscussmessagePost.params) {\r\n  return post<IWriteDiscussmessagePost.data>(`${url.base}/content.write_discussmessage.post`, params);\r\n}\r\n/**\r\n * 评论点赞\r\n */\r\nexport function api_like_discussmessage_post(params: ILikeDiscussmessagePost.params) {\r\n  return post<ILikeDiscussmessagePost.data>(`${url.base}/content.like_discussmessage.post`, params);\r\n}\r\n","import { AxiosRequestConfig, get, url, post, http } from '@/utils/http';\r\nimport { ITemplateSubscription } from './mina_app.i';\r\n\r\n/**\r\n * 小程序推送与模板消息\r\n * https://gitlab.weike.fm/lh/lh-docs/blob/master/%E6%A2%A8%E8%8A%B1%E5%90%AC%E4%B9%A6/V1.3.1/%E6%A2%A8%E8%8A%B1v1.31%E5%8A%9F%E8%83%BD%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0.md#114-%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%A8%E9%80%81%E4%B8%8E%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF\r\n */\r\nexport function api_template_subscription(params: ITemplateSubscription.params) {\r\n  return post<ITemplateSubscription.data>(`${url.base}/mina_app.template_subscription.post`, params);\r\n}\r\n","/*\r\n * @Description: 个人中心\r\n * @LastEditTime: 2021-08-24 17:21:49\r\n */\r\n\r\nimport { get, url, post } from '@/utils/http';\r\nimport { IMyPurchased, IWithdrawal, IMyNotes, IMyRecordScore, IMyRecordOverage, IPersonal, IPersonalDiscussGet } from './personal_center.i';\r\n// 我的课程\r\nexport function api_bought_list() {\r\n  return get<IMyPurchased.Data>(`${url.base}/personal_center.bought_list.get`, {});\r\n}\r\n\r\n/*** 申请提现start */\r\n// 余额\r\nexport function api_find_account_balance() {\r\n  return get<IWithdrawal.Data>(`${url.base}/personal_center.find_account_balance.get`, {});\r\n}\r\n\r\n// 提现按钮\r\nexport function api_withdraw_cash(code: string) {\r\n  return get(`${url.base}/personal_center.withdraw_cash`, { code });\r\n}\r\n/*** 申请提现end */\r\n\r\n// 我的笔记\r\nexport function api_personal_discuss(page: number) {\r\n  return get<IMyNotes.Data>(`${url.base}/personal_center.personal_discuss.get`, { page });\r\n}\r\n\r\n// 学分记录\r\nexport function api_find_account_flows(offset: number) {\r\n  return get<IMyRecordScore.Data>(`${url.base}/personal_center.find_account_flows.get`, {\r\n    limit: 20,\r\n    offset,\r\n  });\r\n}\r\n\r\n// 余额流水记录\r\nexport function api_find_balance_account_flows(offset: number) {\r\n  return get<IMyRecordOverage.Data>(`${url.base}/personal_center.find_balance_account_flows.get`, {\r\n    limit: 20,\r\n    offset,\r\n  });\r\n}\r\n\r\n// 个人中心\r\nexport function api_user_infomation() {\r\n  return get<IPersonal.Data>(`${url.base}/personal_center.infomation.get`, {});\r\n}\r\n\r\n/**\r\n * 获取个人笔记列表\r\n */\r\nexport function api_personal_discuss_list(params: IPersonalDiscussGet.params) {\r\n  return get<IPersonalDiscussGet.data>(`${url.base}/personal_center.personal_discuss.get`, params);\r\n}\r\n","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-20 16:26:00\r\n * @LastEditTime: 2021-08-25 18:28:45\r\n * @Description:\r\n */\r\nimport { AxiosRequestConfig, get, url, post } from '@/utils/http';\r\n\r\n/** 课程学习打点 */\r\nexport function api_lecture_study_dot(lecture_id: number, dot_ts: number) {\r\n  return get(`${url.base}/study_length.lecture_study_dot.get`, {\r\n    lecture_id,\r\n    dot_ts,\r\n  });\r\n}\r\n","// extracted by mini-css-extract-plugin","import { View } from '@tarojs/components';\r\nimport { useEffect, useState } from 'react';\r\nimport { AtActionSheet, AtFloatLayout } from 'taro-ui';\r\nimport './bottom-dialog.scss';\r\n\r\ninterface IBottomDialog {\r\n  children: JSX.Element | JSX.Element[];\r\n  value: boolean;\r\n  /** 弹窗用fixed，默认是absolute */\r\n  fixed?: boolean;\r\n  onClose: Function;\r\n}\r\nconst BottomDialog = (props: IBottomDialog) => {\r\n  let { value, onClose, fixed } = props;\r\n  const [show, setShow] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (value) {\r\n      setShow(true);\r\n    } else {\r\n      setTimeout(() => {\r\n        setShow(false);\r\n      }, 300);\r\n    }\r\n  }, [value]);\r\n\r\n  return (\r\n    <View className={fixed ? 'fixed-box' : ''} catchMove style={{ position: 'fixed', zIndex: 1010 }}>\r\n      {/* <AtFloatLayout isOpened={value} onClose={() => onClose?.()}>\r\n        {show && props.children}\r\n      </AtFloatLayout> */}\r\n      <AtActionSheet isOpened={value} onCancel={() => console.log('onCancel')} onClose={() => onClose?.()}>\r\n        {show && props.children}\r\n      </AtActionSheet>\r\n    </View>\r\n  );\r\n};\r\nexport default BottomDialog;\r\n","// extracted by mini-css-extract-plugin","/*\r\n * @Description: file content\r\n * @LastEditTime: 2021-09-08 15:42:54\r\n */\r\nimport { Text, View } from '@tarojs/components';\r\nimport { useMemo } from 'react';\r\nimport './dialog.scss';\r\n\r\ninterface IDialog {\r\n  backgroundColor?: string;\r\n  title?: string;\r\n  showClose?: boolean;\r\n  /** 是否点击空白区域关闭 */\r\n  maskClose?: boolean;\r\n  maskColor?: string;\r\n  children: JSX.Element;\r\n  value: boolean;\r\n  setValue: Function;\r\n}\r\nconst Dialog = (props: IDialog) => {\r\n  const { backgroundColor, maskClose, maskColor, title, showClose, value, setValue } = props;\r\n  return useMemo(() => {\r\n    console.log('dialog value', value);\r\n    return value ? (\r\n      <View catchMove className=\"modal-mask\" onClick={() => maskClose && setValue?.(false)} style={'background-color: ' + maskColor}>\r\n        <View onClick={(e) => e.stopPropagation()} className=\"modal-content\" style={'background-color: ' + backgroundColor}>\r\n          {title && <View className=\"modal-title\">{title}</View>}\r\n          {props.children}\r\n        </View>\r\n        {showClose && <Text onClick={() => setValue?.(false)} className=\"icon icon-guanbidanchuang1x\"></Text>}\r\n      </View>\r\n    ) : (\r\n      <></>\r\n    );\r\n  }, [backgroundColor, maskClose, maskColor, title, showClose, value, setValue]);\r\n};\r\nexport default Dialog;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"container--3ZeKw\",\"img\":\"img--264PY\",\"desc\":\"desc--2Nu5n\"};","/*\r\n * @Description: 空状态\r\n * @Date: 2021-08-24 14:25:54\r\n * @LastEditTime: 2021-08-24 14:37:12\r\n */\r\nimport { View, Image } from '@tarojs/components';\r\nimport React from 'react';\r\nimport style from './empty.module.scss';\r\n\r\ninterface IProps {\r\n  img: string;\r\n  desc: string;\r\n}\r\n\r\nconst Empty = (props: IProps) => {\r\n  return (\r\n    <View className={style.container}>\r\n      <Image className={style.img} src={props.img}></Image>\r\n      <View className={style.desc}>{props.desc}</View>\r\n    </View>\r\n  );\r\n};\r\n\r\nEmpty.defaultProps = {\r\n  img: 'https://static-1253442168.file.myqcloud.com/xupload/20210605_empty.png',\r\n  desc: '暂无数据！',\r\n};\r\nexport default Empty;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"no_receive_container\":\"no_receive_container--3i3CI\",\"content\":\"content--1XTtk\",\"img_wrap\":\"img_wrap--3TmUD\",\"content_rgt\":\"content_rgt--vrkOM\",\"title\":\"title--3Z8yV\",\"sub_tit\":\"sub_tit--2iPlO\",\"number\":\"number--3IWCy\",\"time\":\"time--2o0FZ\",\"btn\":\"btn--3Npug\",\"receive_container\":\"receive_container--3cT1n\",\"icon_lingqutixing\":\"icon_lingqutixing--JpHEC\",\"icon_guanbi1x\":\"icon_guanbi1x--2xLbP\",\"text\":\"text--1X6cn\",\"message\":\"message--3-1L-\"};","/*\r\n * @Description: 亲友卡\r\n * @Date: 2021-09-07 15:31:14\r\n * @LastEditTime: 2021-09-10 17:32:22\r\n */\r\nimport React, { useMemo, useState } from 'react';\r\nimport { View, Image, Text, Button } from '@tarojs/components';\r\nimport style from './family-card.module.scss';\r\nimport { ApiStore } from '@/store';\r\nimport { track } from '@/utils/track';\r\n\r\ninterface IProps {\r\n  isShare: boolean;\r\n  shareCount: number;\r\n  validityDate: string;\r\n  showCard: boolean;\r\n  onCloseCard: () => void;\r\n}\r\n\r\nconst FamilyCard = (props: IProps) => {\r\n  const { isShare, shareCount, validityDate, showCard } = props;\r\n  return useMemo(() => {\r\n    return isShare ? (\r\n      <>\r\n        {/* 未领取完的状态 */}\r\n        {shareCount !== 0 && (\r\n          <View className={`${style.no_receive_container} ${style.message}`}>\r\n            <View className={style.content}>\r\n              <View className={style.img_wrap}>\r\n                <Image src=\"https://static-1253442168.file.myqcloud.com/xupload/20210909_card_NHe970J.png\"></Image>\r\n              </View>\r\n              <View className={style.content_rgt}>\r\n                <View className={style.title}>梨花听书亲友畅听卡</View>\r\n                <View className={style.sub_tit}>七天免费听</View>\r\n                <View className={style.number}>{shareCount}张</View>\r\n              </View>\r\n            </View>\r\n            <View className={style.time}>有效期：{validityDate}</View>\r\n            <View className={style.btn}>赠送亲友</View>\r\n            <Button className={style.btn} openType=\"share\" onClick={() => track.setEvent('lh_minecourse_share_ck')}>\r\n              赠送亲友\r\n            </Button>\r\n          </View>\r\n        )}\r\n        {/* 领取完的状态 */}\r\n        {shareCount === 0 && showCard && (\r\n          <View className={`${style.receive_container}  ${style.message}`}>\r\n            <View>\r\n              <Text className={`icon icon-lingqutixing ${style.icon_lingqutixing}`}></Text>\r\n              <Text className={style.text}>你的听书亲友卡被领取完啦~</Text>\r\n            </View>\r\n            <Text className={`icon icon-a-guanbi1x ${style.icon_guanbi1x}`} onClick={props.onCloseCard}></Text>\r\n          </View>\r\n        )}\r\n      </>\r\n    ) : null;\r\n  }, [isShare, shareCount, validityDate, showCard]);\r\n};\r\n\r\nexport default FamilyCard;\r\n","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-23 14:32:23\r\n * @LastEditTime: 2021-09-13 14:43:20\r\n * @Description:\r\n */\r\nimport { configDefault } from '@/config/config';\r\nimport WX from '@/utils/WX';\r\nimport style from './index.module.scss';\r\nimport { Button, Text, View } from '@tarojs/components';\r\n\r\nconst FollowRemind = () => {\r\n  const handleRemind = () => {\r\n    WX.navigateTo('/pages/h5/h5', {\r\n      webViewUrl: configDefault.remind_qr,\r\n    });\r\n  };\r\n  return (\r\n    <View>\r\n      <View className={`${style.follow_remind} ${style.flex}`}>\r\n        <View className={style.flex}>\r\n          <Text className={`${style.icon_xiaoxitixing} icon-xiaoxitixing icon`}></Text>\r\n          <Text className={style.remind_text}>请关注公众号接收课程更新提醒</Text>\r\n        </View>\r\n        <Button hoverClass={style.remind_button_active} className={style.remind_button} onClick={handleRemind}>\r\n          接收提醒\r\n        </Button>\r\n      </View>\r\n      <View className={style.margin}></View>\r\n    </View>\r\n  );\r\n};\r\nFollowRemind.option = {\r\n  addGlobalClass: true,\r\n};\r\nexport default FollowRemind;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"follow_remind\":\"follow_remind--295th\",\"margin\":\"margin--qnb32\",\"flex\":\"flex--3vjod\",\"icon_xiaoxitixing\":\"icon_xiaoxitixing--2f-oq\",\"remind_text\":\"remind_text--1NjQ0\",\"remind_button\":\"remind_button--1PnPE\",\"remind_button_active\":\"remind_button_active--3_wT_\"};","// extracted by mini-css-extract-plugin","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-24 15:42:16\r\n * @LastEditTime: 2021-09-23 15:08:23\r\n * @Description:\r\n */\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { View, Image, Text, RichText, ScrollView } from '@tarojs/components';\r\nimport FollowRemind from '@/components/follow-remind/follow-remind';\r\nimport './lecture-list.scss';\r\nimport { getToken } from '@/utils/login';\r\nimport { api_judge_subscribed, api_judge_user_access, api_share_card_count } from '@/api/account/account';\r\nimport Taro, { getCurrentInstance, useDidShow } from '@tarojs/taro';\r\nimport Loading from '@/components/loading/loading';\r\nimport { ApiStore } from '@/store';\r\nimport Empty from '../empty/empty';\r\nimport { IDailyContent } from '@/api/content/content.i';\r\nimport { api_channel_daily_content_get } from '@/api/content/content';\r\nimport { handleChannelContent, timeStream, getPicture } from '@/utils/tools';\r\nimport FamilyCard from '@/components/family-card/family-card';\r\nimport { configDefault } from '@/config/config';\r\nimport { track } from '@/utils/track';\r\n\r\nexport type LectureListProps = {\r\n  /** 判断是专栏计划页还是我的课程页 */\r\n  from?: string;\r\n};\r\n\r\nconst LectureList = (props: LectureListProps) => {\r\n  const [dailyContent, setDailyContent] = useState<IDailyContent.FomateDailyContent[]>([]);\r\n  const [channelInfo, setChannelInfo] = useState<IDailyContent.ChannelInfo>({} as IDailyContent.ChannelInfo);\r\n  const [loading, setLoading] = useState(true);\r\n  const [hasJoin, setHasJoin] = useState(true); // 是否加入\r\n  const [isSubscribed, setIsSubscribed] = useState(true); // 是否关注公众号\r\n\r\n  // 分享亲友卡的数据\r\n  const [isShare, setIsShare] = useState<boolean>(false);\r\n  const [shareCount, setShareCount] = useState<number>(0);\r\n  const [validityDate, setValidityDate] = useState<string>('');\r\n  const [showCard, setShowCard] = useState<boolean>(false); // 是否展示领取完的卡片样式\r\n\r\n  const { from } = props;\r\n  const channelId = useRef(0);\r\n\r\n  useDidShow(() => {\r\n    let ch_id = 0;\r\n    // channel-plan\r\n    if (from === 'plan') {\r\n      const $instance = getCurrentInstance();\r\n      ch_id = $instance.router?.params.channel_id ? +$instance.router?.params.channel_id : configDefault.channel_id;\r\n    } else {\r\n      // pages/mine-course/mine-course\r\n      const _channelId = Taro.getStorageSync('setChannelId');\r\n      ch_id = _channelId || configDefault.channel_id;\r\n    }\r\n    channelId.current = ch_id;\r\n    if (ch_id) {\r\n      checkIsNewUser();\r\n    }\r\n  });\r\n\r\n  /**\r\n   * @description: 是否关注公众号\r\n   * @param {*}\r\n   * @return {*}\r\n   */\r\n  const checkHasSubscribed = async () => {\r\n    const subscribe = Taro.getStorageSync('setIsSubscribe') ? JSON.parse(Taro.getStorageSync('setIsSubscribe')) : false;\r\n    if (subscribe) {\r\n      setIsSubscribed(true);\r\n      return;\r\n    }\r\n    const account_id = Number(Taro.getStorageSync('account').id ?? '');\r\n    try {\r\n      const res = await api_judge_subscribed(account_id);\r\n      if (res) {\r\n        Taro.setStorageSync('setIsSubscribe', res.is_subscribed);\r\n        setIsSubscribed(res.is_subscribed);\r\n      }\r\n    } catch (error) {\r\n      console.error('api_judge_subscribed error', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 获取分享亲友卡的信息\r\n   */\r\n\r\n  const getShareCard = async () => {\r\n    try {\r\n      const res = await api_share_card_count(channelId.current);\r\n      if (res) {\r\n        const isExpires = +res.validity_date * 1000 < Date.now(); // 判断时间过没过期\r\n        const closeCard = Taro.getStorageSync('closeCard'); // 获取点击关闭按钮的事件缓存\r\n        const isShowCard = !closeCard && !isExpires;\r\n        setIsShare(res.is_share && !isExpires);\r\n        setShareCount(res.friend_share_count);\r\n        setValidityDate(`${timeStream(+res.validity_date * 1000, 'YMD_HMS')}`);\r\n        setShowCard(isShowCard);\r\n      }\r\n    } catch (error) {}\r\n  };\r\n\r\n  // 关闭亲友卡\r\n  const onCloseCard = () => {\r\n    setShowCard(false);\r\n    setIsShare(false);\r\n    Taro.setStorageSync('closeCard', true);\r\n  };\r\n\r\n  /**\r\n   * @description: 是否是新用户\r\n   * @param {*}\r\n   * @return {*}\r\n   */\r\n  const checkIsNewUser = () => {\r\n    getToken(\r\n      async () => {\r\n        checkHasSubscribed();\r\n        await getShareCard();\r\n        const accessStatus = Taro.getStorageSync('setIsAccess');\r\n        if (accessStatus === 'join') {\r\n          getChannelDaily();\r\n        } else {\r\n          try {\r\n            const res = await api_judge_user_access();\r\n            if (res) {\r\n              Taro.setStorageSync('setIsAccess', res.is_access ? 'join' : null);\r\n              res.is_access ? getChannelDaily() : onJoin();\r\n            }\r\n          } catch (error) {\r\n            console.error('api_judge_user_access error', error);\r\n          }\r\n        }\r\n      },\r\n      () => {\r\n        onJoin();\r\n        setIsSubscribed(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  const onJoin = () => {\r\n    setLoading(false);\r\n    setHasJoin(false);\r\n  };\r\n\r\n  /**\r\n   * @description: 获取课程列表\r\n   * @param {*}\r\n   * @return {*}\r\n   */\r\n  const getChannelDaily = async () => {\r\n    try {\r\n      let res = await api_channel_daily_content_get({ channel_id: channelId.current });\r\n      if (res) {\r\n        res = handleChannelContent(res);\r\n        Taro.setStorageSync('set_fomate_daily_content', res);\r\n        const { channel_info, book_content, fomate_daily_content } = res;\r\n        conformChannelDaily(fomate_daily_content, book_content, channel_info);\r\n      }\r\n    } catch (error) {\r\n      console.error('getChannelDaily error', error);\r\n    }\r\n  };\r\n\r\n  //由于后端偷懒没整合数据 前端做\r\n  const conformChannelDaily = (fomate_daily_content, book_content, channel_info) => {\r\n    fomate_daily_content.forEach((item) => {\r\n      const books: any[] = [];\r\n      //获取每周下有几本书\r\n      item.content.forEach((lecture) => {\r\n        if (lecture.object_type === 'lecture') {\r\n          const index = books.findIndex((book) => book.id === lecture.book_id);\r\n\r\n          if (index === -1) {\r\n            books.push({\r\n              ...book_content[lecture.book_id],\r\n              lectures: [lecture],\r\n            });\r\n          } else {\r\n            books[index].lectures.push(lecture);\r\n          }\r\n        } else {\r\n          books.push(lecture);\r\n        }\r\n      });\r\n      item.books = books;\r\n    });\r\n\r\n    setDailyContent(fomate_daily_content);\r\n    setChannelInfo(channel_info);\r\n    setHasJoin(true);\r\n    setLoading(false);\r\n  };\r\n\r\n  /**\r\n   * @description: 点击进入周测页\r\n   * @param {*} e\r\n   * @return {*}\r\n   */\r\n  const bindExam = (e) => {\r\n    const { book, week } = e.currentTarget.dataset;\r\n    if (book.lectures) return;\r\n    switch (book.unlock) {\r\n      case 0:\r\n        toast();\r\n        break;\r\n      case 1:\r\n        Taro.navigateTo({\r\n          url: `/pages/exam/exam?week_num=${week}&channel_id=${book.channel_id}`,\r\n        });\r\n        break;\r\n      case 2:\r\n        ApiStore.common.bindAuthorization();\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @description: 点击进入播放页面\r\n   * @param {*} e\r\n   * @return {*}\r\n   */\r\n  const bindPlayLecture = (e) => {\r\n    if (props.from === 'plan') {\r\n      track.setEvent('lh_plan_ro_ck');\r\n    }\r\n    const item = e.currentTarget.dataset.item;\r\n    switch (item.unlock) {\r\n      case 0:\r\n        toast();\r\n        break;\r\n      case 1:\r\n        Taro.navigateTo({\r\n          url: `/pages/detail/detail?object_id=${item.object_id}`,\r\n        });\r\n        break;\r\n      case 2:\r\n        ApiStore.common.bindAuthorization();\r\n        break;\r\n    }\r\n  };\r\n\r\n  const toast = () => {\r\n    Taro.showToast({\r\n      title: '不要着急，每天解锁一节课哦！',\r\n      icon: 'none',\r\n    });\r\n  };\r\n\r\n  /**\r\n   * 规则点击\r\n   */\r\n  const onRule = () => {\r\n    Taro.navigateTo({\r\n      url: '/pages/h5/h5?webViewUrl=https://mp.weixin.qq.com/s/Ic-qij_XA3ZPUnUUHR88hg',\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  return (\r\n    <ScrollView scrollY>\r\n      {hasJoin ? (\r\n        <View className=\"my-lecture-container\">\r\n          {!isSubscribed && <FollowRemind></FollowRemind>}\r\n          <Image className=\"banner\" mode=\"aspectFill\" src={channelInfo.book_url}></Image>\r\n          <View className=\"lecture-rule\" onClick={onRule}>\r\n            <Text className=\"icon icon-guizeshuoming rule-icon\"></Text>\r\n            规则说明\r\n          </View>\r\n\r\n          {/* 专栏计划页欢迎语 */}\r\n          {from && (\r\n            <View className=\"message\" style={{ marginBottom: isShare ? '30rpx' : '40rpx' }}>\r\n              <RichText className=\"description\" nodes={channelInfo.welcome_language}></RichText>\r\n              <View className=\"info flex\">{channelInfo.welcome_text}</View>\r\n            </View>\r\n          )}\r\n          {/* 亲友卡 */}\r\n          <FamilyCard shareCount={shareCount} isShare={isShare} validityDate={validityDate} showCard={showCard} onCloseCard={onCloseCard} />\r\n          {/*  items.week_num===0 是先导课，其他为周课程，unlock===0 锁住 unlock===1 已解锁 unlock===2 购物车 */}\r\n          <View className=\"lecture-list-wrapper\">\r\n            {dailyContent.map((items, index) => {\r\n              return (\r\n                <View key={index}>\r\n                  <View className={'cells-wrapper ' + (!items.week_num ? 'cells-wrapper1' : 'cells-wrapper2')}>\r\n                    <View className=\"week-title\">\r\n                      <View className=\"llw-tip\"></View>\r\n                      {items.week_num ? (\r\n                        <Text className=\"items-title\">{'第' + items.week_num + '周'}</Text>\r\n                      ) : (\r\n                        <View className=\"items-title\">先导课</View>\r\n                      )}\r\n                    </View>\r\n                    {items.books.map((book) => {\r\n                      return (\r\n                        <View key={book.id}>\r\n                          <View className={'cells-content flex ' + (book.object_type === 'form' ? 'form-cells' : '')}>\r\n                            <Image\r\n                              className=\"lecture-icon\"\r\n                              lazyLoad\r\n                              mode=\"aspectFill\"\r\n                              src={getPicture(book.object_type === 'form' ? book.json_extend.cover_url : book.cover_url, 178)}></Image>\r\n                            <View className=\"cell-right\" onClick={bindExam} data-book={book} data-week={items.week_num}>\r\n                              {items.week_num ? (\r\n                                <View>\r\n                                  {book.object_type === 'form' ? (\r\n                                    <View className=\"lecture-text flex\">\r\n                                      <View>{book.title}</View>\r\n                                      {/*  已解锁  */}\r\n                                      {book.unlock === 1 ? (\r\n                                        <Text className=\"icon icon-gengduo\"></Text>\r\n                                      ) : book.unlock === 2 ? (\r\n                                        <View className=\"cart\">\r\n                                          <Text className=\"icon icon-gouwuche\"></Text>\r\n                                        </View>\r\n                                      ) : (\r\n                                        <Text className=\"icon icon-suo\"></Text>\r\n                                      )}\r\n                                      {/*  未购  */}\r\n                                      {/*  未解锁  */}\r\n                                    </View>\r\n                                  ) : (\r\n                                    <View className=\"lecture-text lecture-text_basic\">{book.book_name}</View>\r\n                                  )}\r\n                                  {/*  非周测  */}\r\n                                </View>\r\n                              ) : (\r\n                                <View className=\"lecture-text\">{book.lectures[0].title}</View>\r\n                              )}\r\n                              {/*  先导课  */}\r\n                              {/* 每本书下章节 */}\r\n                              {book.lectures &&\r\n                                book.lectures.map((lecture) => {\r\n                                  return (\r\n                                    <View\r\n                                      className={'lecture-item ' + (items.week_num ? 'flex' : '')}\r\n                                      key={lecture.i}\r\n                                      onClick={bindPlayLecture}\r\n                                      data-item={lecture}\r\n                                      data-week-num={items.week_num}>\r\n                                      {items.week_num ? (\r\n                                        <View\r\n                                          hoverClass=\"summary-active\"\r\n                                          className={'summary ' + (lecture.unlock !== 1 ? 'light-lock' : '')}>\r\n                                          {lecture.title}\r\n                                        </View>\r\n                                      ) : (\r\n                                        <RichText className=\"summary\" nodes={lecture.object_info.description}></RichText>\r\n                                      )}\r\n                                      {/*  已解锁  */}\r\n                                      {lecture.unlock === 1 ? (\r\n                                        <View className=\"arrow-icon\">\r\n                                          <Text className=\"icon icon-gengduo\"></Text>\r\n                                        </View>\r\n                                      ) : lecture.unlock === 2 ? (\r\n                                        <View className=\"cart\">\r\n                                          <Text className=\"icon icon-gouwuche\"></Text>\r\n                                        </View>\r\n                                      ) : (\r\n                                        <View>\r\n                                          <Text className=\"icon icon-suo\"></Text>\r\n                                        </View>\r\n                                      )}\r\n                                      {/*  未购  */}\r\n                                      {/*  未解锁  */}\r\n                                    </View>\r\n                                  );\r\n                                })}\r\n                            </View>\r\n                          </View>\r\n                        </View>\r\n                      );\r\n                    })}\r\n                  </View>\r\n                </View>\r\n              );\r\n            })}\r\n          </View>\r\n        </View>\r\n      ) : (\r\n        <Empty desc=\"你还没有加入课程噢~\" />\r\n      )}\r\n    </ScrollView>\r\n  );\r\n};\r\n\r\nexport default LectureList;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"bottom_line\":\"bottom_line--3LD2i\"};","/*\r\n * @Description: 用在列表里面，做滚动加载使用\r\n * @Date: 2021-08-24 15:02:34\r\n * @LastEditTime: 2021-08-25 09:53:49\r\n */\r\nimport { View } from '@tarojs/components';\r\nimport style from './load-more.module.scss';\r\n\r\ninterface IProps {\r\n  is_last_page: boolean;\r\n  no_more_text: string;\r\n  loading_text: string;\r\n}\r\nconst LoadMore = (props: IProps) => {\r\n  return <View className={style.bottom_line}>{props.is_last_page ? props.no_more_text : props.loading_text}</View>;\r\n};\r\nLoadMore.defaultProps = {\r\n  no_more_text: '翻完了~',\r\n  loading_text: '加载中...',\r\n};\r\n\r\nexport default LoadMore;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loading_container\":\"loading_container--agVvD\",\"loading_img\":\"loading_img--qB8JA\"};","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-23 11:27:42\r\n * @LastEditTime: 2021-08-23 15:55:44\r\n * @Description: \r\n */\r\nimport { Image, View } from '@tarojs/components';\r\nimport style from './loading.module.scss';\r\n\r\nconst Loading = () => {\r\n  return (\r\n    <View className={style.loading_container}>\r\n      <Image className={style.loading_img} src='https://static-1253442168.file.myqcloud.com/xupload/20210922_loading.gif'></Image>\r\n    </View>\r\n  );\r\n};\r\nexport default Loading;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"header--1R4V8\",\"border_bottom\":\"border_bottom--1Ifxy\",\"background\":\"background--1lBwH\",\"header_bar\":\"header_bar--3nCWd\",\"header_bar_line\":\"header_bar_line--oBVjd\",\"header_bar_back\":\"header_bar_back--1vm7p\",\"header_bar_back_icon\":\"header_bar_back_icon--36ipL\",\"header_bar_home\":\"header_bar_home--2l5Fk\",\"header_bar_home_icon\":\"header_bar_home_icon--2-RAO\",\"header_title\":\"header_title--3BGWj\"};","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-20 16:26:00\r\n * @LastEditTime: 2021-08-24 14:37:08\r\n * @Description:\r\n */\r\nimport { Component } from 'react';\r\nimport { View, Image } from '@tarojs/components';\r\nimport style from './navbar.module.scss';\r\nimport WX from '@/utils/WX';\r\n\r\ninterface IState {\r\n  statusBarHeight: number; // 导航高度\r\n  titleBarHeight: number; // 导航标题高度\r\n}\r\ninterface IProps {\r\n  noBackground?: boolean;\r\n  noBorder?: boolean;\r\n  /** */\r\n  white?: boolean;\r\n  /** 隐藏返回 */\r\n  hiddenBack?: boolean;\r\n  /** 标题 */\r\n  title?: string;\r\n  /** 自定义导航背景图 */\r\n  setBgImage?: string;\r\n}\r\nclass NavBar extends Component<IProps, IState> {\r\n  IMAGE = {\r\n    BLACK: 'https://staticqc-operating.lycheer.net/image/weike-SYAtWp-226817545.png',\r\n    WHITE: 'https://staticqc-operating.lycheer.net/image/weike-CfsdHt-732417899.png',\r\n  };\r\n  state = {\r\n    statusBarHeight: 30, // 取个中间值30\r\n    titleBarHeight: 46, // 取ios和android中间值\r\n  };\r\n  async componentDidMount() {\r\n    console.log('componentDidMount');\r\n    const platform = wx.platform || wx.getSystemInfoSync();\r\n    const { statusBarHeight, titleBarHeight } = platform;\r\n    this.setState({ statusBarHeight, titleBarHeight });\r\n  }\r\n  headerGoTo = () => {\r\n    WX.navigateBack(1);\r\n  };\r\n  render() {\r\n    const { noBorder, hiddenBack, title, setBgImage, white } = this.props;\r\n    const { statusBarHeight, titleBarHeight } = this.state;\r\n    return (\r\n      <View style={{ height: `${titleBarHeight + statusBarHeight}px` }}>\r\n        <View\r\n          className={`${style.header} ${!noBorder ? style.border_bottom : ''}`}\r\n          style={{\r\n            height: `${titleBarHeight}px`,\r\n            paddingTop: `${statusBarHeight}px`,\r\n            backgroundImage: setBgImage ? `url(${setBgImage})` : '',\r\n            backgroundSize: setBgImage ? `100% ${titleBarHeight + statusBarHeight}px` : '',\r\n            color: white ? '#fff' : '#000',\r\n          }}>\r\n          <View className={style.header_bar} onClick={this.headerGoTo}>\r\n            {!hiddenBack && titleBarHeight > 0 && (\r\n              <View className={style.header_bar_back}>\r\n                <Image className={style.header_bar_back_icon} mode='widthFix' src={white ? this.IMAGE.WHITE : this.IMAGE.BLACK} />\r\n              </View>\r\n            )}\r\n          </View>\r\n          {titleBarHeight > 0 && (\r\n            <View className={style.header_title} style={{ color: `${white ? '#fff' : '#000'}` }}>\r\n              {title}\r\n            </View>\r\n          )}\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n}\r\nexport default NavBar;\r\n","// extracted by mini-css-extract-plugin","import { ApiStore } from '@/store';\r\nimport WX from '@/utils/WX';\r\nimport { Image, Text, View } from '@tarojs/components';\r\nimport { observer } from 'mobx-react';\r\nimport './player-float.scss';\r\n\r\n/** 播放的悬浮窗 */\r\nconst PlayerFloat = observer(() => {\r\n  const status = ApiStore.player.playingState;\r\n  const playingInfo = ApiStore.player.playingInfo;\r\n  if (status === 'ended' || !playingInfo.src) return <></>;\r\n\r\n  const bindGoPlay = () => {\r\n    WX.navigateTo('/pages/detail/detail', {\r\n      object_id: playingInfo.object_id,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <View className=\"player-float flex\" onClick={bindGoPlay}>\r\n      <Image className=\"pf-cover-url abso\" mode=\"aspectFit\" src={playingInfo.cover_url}></Image>\r\n      <View className=\"pf-cover-mask abso\"></View>\r\n      {status === 'play' ? (\r\n        <View className=\"pf-wrap\">\r\n          <View className=\"pf-music\">\r\n            <Text className=\"pf-item m1\"></Text>\r\n            <Text className=\"pf-item m2\"></Text>\r\n            <Text className=\"pf-item m3\"></Text>\r\n            <Text className=\"pf-item m1\"></Text>\r\n            <Text className=\"pf-item m2\"></Text>\r\n          </View>\r\n        </View>\r\n      ) : (\r\n        <Text className=\"icon icon-houtaibofang\"></Text>\r\n      )}\r\n    </View>\r\n  );\r\n});\r\nexport default PlayerFloat;\r\n","const miniInfo = wx.getAccountInfoSync()?.miniProgram;\r\nconst env = miniInfo?.envVersion;\r\nconsole.log('环境判断：', env);\r\nconst prodConfig = {\r\n  channel_id: 1099596,\r\n  h5_url: 'https://lihua-act.tryweike.net/listen',\r\n  remind_qr: 'https://mp.weixin.qq.com/s/vV09s8XJZQ3cuojRfD5gfg',\r\n  weChat_qr: 'https://mp.weixin.qq.com/s/8eVXWS4X5lC5njiDAaDBhw',\r\n} as const;\r\n\r\nconst devConfig = {\r\n  channel_id: 1067901,\r\n  h5_url: 'https://dbg.lizhiweike.com/lihua-activity/listen',\r\n  remind_qr: 'https://mp.weixin.qq.com/s/vV09s8XJZQ3cuojRfD5gfg',\r\n  weChat_qr: 'https://mp.weixin.qq.com/s/8eVXWS4X5lC5njiDAaDBhw',\r\n} as const;\r\n\r\nconst prodUrl = {\r\n  main: 'https://m.lizhiweike.com',\r\n  gw: 'https://api-gw.lizhiweike.com',\r\n  middleground: 'https://m.lizhiweike.com',\r\n} as const;\r\n\r\nconst devUrl = {\r\n  main: 'https://basereq-dev.weike.fm',\r\n  gw: 'https://api.dev4.weike.fm',\r\n  middleground: 'https://dbg.weike.fm',\r\n} as const;\r\n\r\nlet _baseUrl;\r\nlet _configDefault;\r\nif (env === 'develop') {\r\n  _baseUrl = devUrl;\r\n  _configDefault = devConfig;\r\n  // _baseUrl = prodUrl;\r\n  // _configDefault = prodConfig;\r\n} else if (env === 'trial') {\r\n  // _baseUrl = devUrl;\r\n  // _configDefault = devConfig;\r\n  _baseUrl = prodUrl;\r\n  _configDefault = prodConfig;\r\n} else if (env === 'release') {\r\n  _baseUrl = prodUrl;\r\n  _configDefault = prodConfig;\r\n} else {\r\n  _baseUrl = prodUrl;\r\n  _configDefault = prodConfig;\r\n}\r\n\r\nexport const baseUrl = _baseUrl as typeof devUrl | typeof prodUrl;\r\nexport const configDefault = _configDefault as typeof prodConfig | typeof devConfig;\r\n","/*\r\n * Date Format 1.2.3\r\n * (c) 2007-2009 Steven Levithan <stevenlevithan.com>\r\n * MIT license\r\n *\r\n * Includes enhancements by Scott Trenda <scott.trenda.net>\r\n * and Kris Kowal <cixar.com/~kris.kowal/>\r\n *\r\n * Accepts a date, a mask, or a date and a mask.\r\n * Returns a formatted version of the given date.\r\n * The date defaults to the current date/time.\r\n * The mask defaults to dateFormat.masks.default.\r\n */\r\n\r\nlet dateFormat = (function () {\r\n  let token = /d{1,4}|m{1,4}|yy(?:yy)?|([HhMSTt])\\1?|[LloZ]|\"[^\"]*\"|'[^']*'/g,\r\n    timezone =\r\n      /\\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\\d{4})?)\\b/g,\r\n    timezoneClip = /[^-+\\dA-Z]/g,\r\n    pad = function (val, len) {\r\n      val = String(val);\r\n      len = len || 2;\r\n      while (val.length < len) val = '0' + val;\r\n      return val;\r\n    };\r\n\r\n  // Regexes and supporting functions are cached through closure\r\n  return function (date, mask, utc) {\r\n    let dF = dateFormat;\r\n\r\n    // You can't provide utc if you skip other args (use the \"UTC:\" mask prefix)\r\n    if (arguments.length == 1 && Object.prototype.toString.call(date) == '[object String]' && !/\\d/.test(date)) {\r\n      mask = date;\r\n      date = undefined;\r\n    }\r\n\r\n    // Passing date through Date applies Date.parse, if necessary\r\n    date = date ? new Date(date) : new Date();\r\n    if (Number.isNaN(date)) throw SyntaxError('invalid date');\r\n\r\n    mask = String(dF.masks[mask] || mask || dF.masks['default']);\r\n\r\n    // Allow setting the utc argument via the mask\r\n    if (mask.slice(0, 4) == 'UTC:') {\r\n      mask = mask.slice(4);\r\n      utc = true;\r\n    }\r\n\r\n    let _ = utc ? 'getUTC' : 'get',\r\n      d = date[_ + 'Date'](),\r\n      D = date[_ + 'Day'](),\r\n      m = date[_ + 'Month'](),\r\n      y = date[_ + 'FullYear'](),\r\n      H = date[_ + 'Hours'](),\r\n      M = date[_ + 'Minutes'](),\r\n      S = date[_ + 'Seconds'](),\r\n      L = date[_ + 'Milliseconds'](),\r\n      o = utc ? 0 : date.getTimezoneOffset(),\r\n      flags = {\r\n        d: d,\r\n        dd: pad(d),\r\n        ddd: dF.i18n.dayNames[D],\r\n        dddd: dF.i18n.dayNames[D + 7],\r\n        m: m + 1,\r\n        mm: pad(m + 1),\r\n        mmm: dF.i18n.monthNames[m],\r\n        mmmm: dF.i18n.monthNames[m + 12],\r\n        yy: String(y).slice(2),\r\n        yyyy: y,\r\n        h: H % 12 || 12,\r\n        hh: pad(H % 12 || 12),\r\n        H: H,\r\n        HH: pad(H),\r\n        M: M,\r\n        MM: pad(M),\r\n        S: S,\r\n        SS: pad(S),\r\n        l: pad(L, 3),\r\n        L: pad(L > 99 ? Math.round(L / 10) : L),\r\n        t: H < 12 ? 'a' : 'p',\r\n        tt: H < 12 ? 'am' : 'pm',\r\n        T: H < 12 ? 'A' : 'P',\r\n        TT: H < 12 ? 'AM' : 'PM',\r\n        Z: utc ? 'UTC' : (String(date).match(timezone) || ['']).pop().replace(timezoneClip, ''),\r\n        o: (o > 0 ? '-' : '+') + pad(Math.floor(Math.abs(o) / 60) * 100 + (Math.abs(o) % 60), 4),\r\n        // S: ['th', 'st', 'nd', 'rd'][d % 10 > 3 ? 0 : (((d % 100) - (d % 10) != 10) * d) % 10],\r\n      };\r\n\r\n    return mask.replace(token, function ($0) {\r\n      return $0 in flags ? flags[$0] : $0.slice(1, $0.length - 1);\r\n    });\r\n  };\r\n})();\r\n\r\n// Some common format strings\r\ndateFormat.masks = {\r\n  default: 'ddd mmm dd yyyy HH:MM:SS',\r\n  shortDate: 'm/d/yy',\r\n  mediumDate: 'mmm d, yyyy',\r\n  longDate: 'mmmm d, yyyy',\r\n  fullDate: 'dddd, mmmm d, yyyy',\r\n  shortTime: 'h:MM TT',\r\n  mediumTime: 'h:MM:SS TT',\r\n  longTime: 'h:MM:SS TT Z',\r\n  isoDate: 'yyyy-mm-dd',\r\n  isoTime: 'HH:MM:SS',\r\n  isoDateTime: 'yyyy-mm-dd\"T\"HH:MM:ss',\r\n  isoUtcDateTime: 'UTC:yyyy-mm-dd\"T\"HH:MM:ss\"Z\"',\r\n};\r\n\r\n// Internationalization strings\r\ndateFormat.i18n = {\r\n  dayNames: [\r\n    '周日',\r\n    '周一',\r\n    '周二',\r\n    '周三',\r\n    '周四',\r\n    '周五',\r\n    '周六',\r\n    'Sunday',\r\n    'Monday',\r\n    'Tuesday',\r\n    'Wednesday',\r\n    'Thursday',\r\n    'Friday',\r\n    'Saturday',\r\n  ],\r\n  // dayNames: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\r\n  monthNames: [\r\n    'Jan',\r\n    'Feb',\r\n    'Mar',\r\n    'Apr',\r\n    'May',\r\n    'Jun',\r\n    'Jul',\r\n    'Aug',\r\n    'Sep',\r\n    'Oct',\r\n    'Nov',\r\n    'Dec',\r\n    'January',\r\n    'February',\r\n    'March',\r\n    'April',\r\n    'May',\r\n    'June',\r\n    'July',\r\n    'August',\r\n    'September',\r\n    'October',\r\n    'November',\r\n    'December',\r\n  ],\r\n};\r\n\r\n// module.exports = dateFormat;\r\nexport default dateFormat;\r\n","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-23 14:41:19\r\n * @LastEditTime: 2021-09-22 17:07:59\r\n * @Description:\r\n */\r\nimport { configDefault } from '@/config/config';\r\nimport { makeAutoObservable } from 'mobx';\r\n\r\ntype ShareParams = {\r\n  /** 分享标题 */\r\n  title: string;\r\n  /** 入口页面 */\r\n  path: string;\r\n  /** 分享图片 */\r\n  imageUrl: string;\r\n};\r\n\r\ntype NoteType = 'add' | 'edit';\r\nclass Common {\r\n  /** 发送笔记的弹窗 */\r\n  showNoteDialog = false;\r\n  /** 发表笔记的类型 */\r\n  noteType: NoteType = 'add';\r\n  /** 发表笔记的内容 */\r\n  noteContent: string = '';\r\n  /** 默认分享文案 */\r\n  defaultShareInfo: ShareParams = {\r\n    title: '想成为高情商、有才识、有气质的智慧女性吗？',\r\n    path: '/pages/activity/activity?from=home', //若无path 默认跳转分享页\r\n    imageUrl: 'https://static-1253442168.file.myqcloud.com/xupload/20210610_shareImg.png', //若无imageUrl 截图当前页面\r\n  };\r\n  /** 亲友卡分享文案 */\r\n  // cardShareInfo: ShareParams = {\r\n  //   title: '我送你一张梨花听书7天VIP卡，快点击领取吧～',\r\n  //   path: `/pages/activity/activity?from=friend&user_type=presented&channel_id=${getStorage('setChannelId') ?? ''}&sender_id=${\r\n  //     getStorage('account').id ?? ''\r\n  //   }`,\r\n  //   imageUrl: 'https://static-1253442168.file.myqcloud.com/xupload/20210909_share-card.png',\r\n  // };\r\n\r\n  constructor() {\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  /**\r\n   * @description: 跳转H5购买\r\n   * @param {*}\r\n   * @return {*}\r\n   */\r\n  bindAuthorization() {\r\n    const scene = wx.getLaunchOptionsSync().scene;\r\n    if (scene === 1000) {\r\n      wx.showToast({\r\n        title: '不要着急，每天解锁一节课哦！',\r\n        icon: 'none',\r\n        duration: 2000,\r\n        mask: true,\r\n      });\r\n      return;\r\n    }\r\n    let url = `/pages/h5/h5?webViewUrl=${configDefault.weChat_qr}`;\r\n    wx.showToast({\r\n      title: '请先购买！如已购买，点击右上角...中重新进入小程序',\r\n      icon: 'none',\r\n      duration: 2000,\r\n      mask: true,\r\n    });\r\n    setTimeout(() => {\r\n      wx.navigateTo({\r\n        url,\r\n      });\r\n    }, 2000);\r\n  }\r\n  /** 设置发送笔记的弹窗显示或隐藏 */\r\n  setNoteDialog(showNoteDialog: boolean) {\r\n    this.showNoteDialog = showNoteDialog;\r\n  }\r\n\r\n  /**\r\n   * 设置发表笔记的类型\r\n   * @param noteType 笔记类型\r\n   */\r\n  setNoteType(noteType: NoteType) {\r\n    this.noteType = noteType;\r\n  }\r\n  /**\r\n   *\r\n   * @param noteContent 笔记内容\r\n   */\r\n  setNoteContent(noteContent: string) {\r\n    this.noteContent = noteContent;\r\n  }\r\n}\r\n\r\nexport const common = new Common();\r\n","/*\r\n * @Author: linzhihai\r\n * @Date: 2021-08-20 16:26:00\r\n * @LastEditTime: 2021-09-14 17:27:15\r\n * @Description:\r\n */\r\nimport { common } from './common';\r\nimport { player } from './player';\r\nimport { user } from './user';\r\n\r\nexport const ApiStore = {\r\n  common,\r\n  player,\r\n  user,\r\n};\r\n","import { runInAction, observable, flow, makeAutoObservable, makeObservable, autorun, toJS, when, reaction } from 'mobx';\r\nimport bgMusic, { AudioError, BackgroundMusicType } from '@/utils/bg-music';\r\nimport { BaseEventOrig } from '@tarojs/components';\r\nimport { SliderProps } from '@tarojs/components/types/Slider';\r\nimport { getAudioResTime, getStorage, isIos, throttle } from '@/utils/tools';\r\nimport { api_lecture_study_dot } from '@/api/study_length/study_length';\r\nimport { track } from '@/utils/track';\r\n\r\nconst detaultInfo: IPlayInfo = {\r\n  anchor: '',\r\n  author: '',\r\n  book_id: 0,\r\n  channel_id: 0,\r\n  duration: 0,\r\n  object_id: 0,\r\n  object_type: 'lecture',\r\n  src: '',\r\n  status: 'pause',\r\n  title: '',\r\n  unlock: 0,\r\n  unread: 0,\r\n  cover_url: '',\r\n};\r\nconst rateMap = {\r\n  0.5: 'icon-a-05beisu',\r\n  1.0: 'icon-a-10beisu',\r\n  1.5: 'icon-a-15beisu',\r\n  2.0: 'icon-a-20beisu',\r\n} as const;\r\ntype IconMap = valueOf<typeof rateMap>;\r\nclass Player {\r\n  /** 播放器进度 */\r\n  progress = 0;\r\n  /** 进度条进度，受到拖拽影响 */\r\n  silderProgress = 0;\r\n  /** 速率 范围 0.5-2.0，默认为 1 */\r\n  rate: PlayerRate = 1.0;\r\n  /** 速率图标 */\r\n  rateMap = rateMap;\r\n  /** 当前页面的playInfo */\r\n  playInfo: IPlayInfo = { ...detaultInfo };\r\n  /** 当前播放中的playInfo */\r\n  playingInfo: IPlayInfo = { ...detaultInfo };\r\n  /** 当前播放中的实际状态 */\r\n  playingState: PlayingStatus = 'pause';\r\n\r\n  /** 能否播放 */\r\n  canPlay = false;\r\n  /** 拖拽中？ */\r\n  draging = false;\r\n  /** 设置seeking的操作，此时需要拦截update触发 */\r\n  seeking = false;\r\n  /** 防止切换id的过程中，因为触发update，导致切换的id的时间被上一次的update替换 */\r\n  isChanging = false;\r\n  /** 初始化的进度位置 */\r\n  initProgress = 0;\r\n  /** 播放时打点上报的timer */\r\n  trackTimer: NodeJS.Timeout | undefined = undefined;\r\n  /** 播放超时操作 */\r\n  timeoutTimer: NodeJS.Timeout | undefined = undefined;\r\n  /** 加载中的提示 */\r\n  tipTimer: NodeJS.Timeout | undefined = undefined;\r\n\r\n  constructor() {\r\n    makeAutoObservable(this, {\r\n      timeoutTimer: false,\r\n      tipTimer: false,\r\n      getProgress: false,\r\n      canPlay: false,\r\n      draging: false,\r\n      seeking: false,\r\n      isChanging: false,\r\n      initBgMusicListener: false,\r\n      setLocalProgress: false,\r\n      initProgress: false,\r\n      rateMap: false,\r\n      playDotTrack: false,\r\n      trackTimer: false,\r\n    });\r\n    this.initBgMusicListener();\r\n    // autorun(() => {\r\n    //   console.log('autorun: ', this.playingInfo);\r\n    // });\r\n    // autorun(() => {\r\n    //   console.warn('autorun: ', this.progress, this.silderProgress);\r\n    // });\r\n    // autorun(() => {\r\n    //   console.log('reaction autorun:this.playingInfo.status ', this.playingInfo.status);\r\n    // });\r\n    // 自动打点计时器 reaction相比于autorun区别：不会在首次初始化时执行\r\n    reaction(\r\n      () => this.playingInfo.status,\r\n      (status) => {\r\n        console.log('reaction status', status, this.playingInfo.status);\r\n        if (status === 'play') {\r\n          clearInterval(this.trackTimer as NodeJS.Timeout);\r\n          this.trackTimer = setInterval(() => this.playDotTrack(), 60000); // 开启打点计时器\r\n        }\r\n        if (status === 'pause' || status === 'stop') {\r\n          clearInterval(this.trackTimer as NodeJS.Timeout);\r\n        }\r\n      }\r\n    );\r\n  }\r\n  /** 播放打点上报 */\r\n  playDotTrack = async () => {\r\n    try {\r\n      const dot_ts = (new Date().getTime() / 1000) >> 0;\r\n      const object_id = this.playingInfo.object_id;\r\n      await api_lecture_study_dot(object_id, dot_ts);\r\n    } catch (error) {\r\n      console.error('打点失败', error);\r\n    }\r\n  };\r\n\r\n  initBgMusicListener() {\r\n    bgMusic.onSeeked(() => {\r\n      setTimeout(() => {\r\n        // this.seeking = false; // 兜底，先点播放，loading的时候拖动进度条\r\n      }, 500);\r\n    });\r\n    bgMusic.onCanplay(() => this.onCanplay());\r\n    bgMusic.onPlay(() => this.onPlay());\r\n    bgMusic.onWaiting(() => this.onWaiting());\r\n    // 监听系统控制器的上一曲\r\n    bgMusic.onPrev(() => {});\r\n    // 监听系统控制器的下一曲\r\n    bgMusic.onNext(() => {});\r\n    bgMusic.onPause(() => this.onPause());\r\n    bgMusic.onStop(() => this.onStop());\r\n    bgMusic.onEnded((isEnded) => this.onEnded(isEnded));\r\n    bgMusic.onError((error) => this.onError(error));\r\n    bgMusic.onTimeUpdate(({ currentTime }) => this.onTimeUpdate(currentTime));\r\n  }\r\n  private onCanplay() {\r\n    console.log('my oncanplay');\r\n    this.canPlay = true;\r\n  }\r\n  private onPlay() {\r\n    console.log('onPlay');\r\n\r\n    // TODO syncStore\r\n    setTimeout(() => {\r\n      this.seeking = false; // 兜底，先点播放，loading的时候拖动进度条\r\n    }, 700); // 播放顺便设置进度条，部分手机会有2次update(每次250ms)也就是至少500ms的0.x的定位，此时得忽略，不然会出现进度条闪烁的问题。\r\n  }\r\n  private onWaiting() {\r\n    console.log('onWaiting', Date.now());\r\n    // this.canPlay = false;\r\n    this.playingInfo.status = 'loading';\r\n    this.playingState = 'loading';\r\n  }\r\n  private onPause() {\r\n    this.playingInfo.status = 'pause';\r\n    this.playingState = 'pause';\r\n  }\r\n  private onStop() {\r\n    console.log('onStop');\r\n    setTimeout(() => {\r\n      runInAction(() => {\r\n        this.playingInfo.status = 'pause';\r\n        this.playingState = 'stop';\r\n        this.progress = 0;\r\n        this.silderProgress = 0;\r\n      });\r\n    }, 1000);\r\n  }\r\n  private onError(error: AudioError) {\r\n    console.log('onError', error);\r\n    const accountId = getStorage('account').id;\r\n    const platform = wx.getPlatform();\r\n    // 上报错误信息\r\n    track.setEvent('lh_play_err', {\r\n      from: accountId,\r\n      audio: this.playingInfo.src,\r\n      platform: `${platform.model}, ${platform.system}, ${platform.version}, ${platform.SDKVersion}`,\r\n      err: error ? error : '',\r\n    });\r\n    runInAction(() => {\r\n      this.playingInfo.status = 'pause';\r\n      this.playingState = 'ended';\r\n      this.setLocalProgress(0);\r\n    });\r\n  }\r\n\r\n  private onEnded(isEnded) {\r\n    console.log('onEnded', isEnded);\r\n    this.playingInfo.status = 'pause';\r\n    this.playingState = 'ended';\r\n    if (isEnded) {\r\n      console.log('设置进度为0');\r\n      setTimeout(() => {\r\n        runInAction(() => {\r\n          this.setSeek(0);\r\n        });\r\n      }, 500); // 节流的最大时间500\r\n    }\r\n  }\r\n  private onTimeUpdate(currentTime: number) {\r\n    // 如果进度条在动，则播放状态需要改成play\r\n    /**\r\n        这里onCanPlay，是因为ios在音频需要完整下载的前提下，\r\n        会默认先触发一次onTimeUpdate，\r\n        此时播放状态默认为播放中（可能是微信bug），\r\n        实际还是在加载中，真正判断是否能播放的状态，是在onCanplay里面\r\n       */\r\n    // console.warn('onTimeUpdate', currentTime, this.seeking);\r\n\r\n    if (this.playingInfo.status !== 'play' && this.canPlay) {\r\n      console.log('这里又设置成play', Date.now());\r\n      this.playingInfo.status = 'play';\r\n      this.playingState = 'play';\r\n      clearTimeout(this.timeoutTimer as NodeJS.Timeout); // 清除掉超时操作的timer\r\n      clearTimeout(this.tipTimer as NodeJS.Timeout); // 清除掉提示操作的timer\r\n    }\r\n    this.setProgress(currentTime);\r\n  }\r\n\r\n  /** 获取当前页面的playinfo */\r\n  get getPlayInfo() {\r\n    if (this.playInfo.object_id !== this.playingInfo.object_id) {\r\n      return this.playInfo;\r\n    } else {\r\n      return this.playingInfo;\r\n    }\r\n  }\r\n\r\n  /** 获取交互进度条 */\r\n  get getSliderProgress() {\r\n    // if (this.playingInfo.object_id && this.silderProgress > this.playingInfo.duration) {\r\n    //   return this.playingInfo.duration;\r\n    // }\r\n    return this.silderProgress;\r\n  }\r\n\r\n  /** 设置进度条位置 */\r\n  setProgress = throttle((currentTime: number) => {\r\n    runInAction(() => {\r\n      // console.log('设置currentTime', currentTime);\r\n      this.progress = currentTime;\r\n      this.setLocalProgress(currentTime);\r\n      if (this.draging) return console.log('draging');\r\n      if (this.seeking) return console.log('seeking');\r\n      // console.log('loading---->', bgMusic.ctx.currentTime, currentTime, bgMusic.ctx.paused);\r\n\r\n      // return console.log('此时不同课程，同步进度', toJS(this.playInfo), toJS(this.playingInfo));\r\n      if (this.playInfo.object_id !== this.playingInfo.object_id) {\r\n        return console.log('id不同', this.playInfo.object_id, this.playingInfo.object_id);\r\n      }\r\n      // 场景A playing 退出详情，切到B，点击play，此时如果音频正在loading，播放进度条是不会变化的，\r\n      // 但是throttle默认trailing为true，会触发最后一次回调，此时因为setPlayInfo已经执行，导致上面id的判断不会被阻塞\r\n      // 那么就会出现进度条闪烁的问题\r\n      // 解决方案：当音频loading时，不设置进度条\r\n      if (this.playingInfo.status === 'loading' && this.isChanging) {\r\n        return console.log('loading->isChanging', this.playingInfo.status, this.isChanging);\r\n      }\r\n      if (Math.floor(this.silderProgress) !== Math.floor(this.progress)) {\r\n        // console.warn('设置currentTime', currentTime);\r\n        // 存储播放状态\r\n        this.silderProgress = currentTime;\r\n      }\r\n    });\r\n  }, 500);\r\n\r\n  setLocalProgress(currentTime: number) {\r\n    const playingInfo = this.playingInfo;\r\n    if (playingInfo && currentTime !== undefined && !this.isChanging) {\r\n      let o = wx.getStorageSync('learningProgress');\r\n      if (!o) {\r\n        o = { [playingInfo.object_id]: currentTime };\r\n      } else {\r\n        o = { ...o, [playingInfo.object_id]: currentTime };\r\n      }\r\n      wx.setStorageSync('learningProgress', o);\r\n    }\r\n  }\r\n\r\n  /** 设置播放器信息 */\r\n\r\n  /** 设置播放状态 */\r\n  setPlayStatus(status: PlayerStatus) {\r\n    this.playInfo = { ...this.playInfo, status };\r\n  }\r\n\r\n  // setPlayInfo(playInfo?: Partial<IPlayInfo>) {\r\n  setPlayInfo(playInfo?: IPlayInfo, playNow?: boolean) {\r\n    console.log('setPlayInfo', playInfo, toJS(this.playingInfo));\r\n    // 课程不相同，进度条初始化\r\n    if (playInfo?.object_id && playInfo.object_id !== this.playingInfo.object_id) {\r\n      this.silderProgress = 0;\r\n    } else if (playInfo?.object_id && playInfo.object_id === this.playingInfo.object_id) {\r\n      this.silderProgress = this.progress;\r\n    }\r\n    this.playInfo = { ...this.playInfo, ...(playInfo ?? {}) };\r\n  }\r\n  goPlay() {\r\n    if (this.playInfo.object_id !== this.playingInfo.object_id) {\r\n      this.playingInfo = this.playInfo;\r\n      this.isChanging = true; // 更改播放源\r\n    }\r\n    console.log('goPlay', toJS(this.playingInfo));\r\n\r\n    bgMusic.setCurrentInfo(this.playingInfo);\r\n    const status = this.playingInfo.status;\r\n    const src = this.playingInfo.src;\r\n    if (!src) {\r\n      this.silderProgress = 0; // 提前清除一下进度条位置，因为onStop有1秒延迟\r\n      bgMusic.stop();\r\n      return wx.showToast({ title: '音频播放失败！未检测到音频文件！', icon: 'none' });\r\n    }\r\n    if (status === 'loading') return console.log('此时loading');\r\n    if (status === 'play') {\r\n      this.goPause();\r\n    } else {\r\n      console.log('goPlay this.initProgress', this.silderProgress);\r\n      if (this.silderProgress) {\r\n        this.seeking = true;\r\n        bgMusic.play({ src, seek: this.silderProgress }, (isSetSrc) => {\r\n          console.log('play this.ctx.paused ---1', isSetSrc);\r\n          this.canPlay = isSetSrc;\r\n        });\r\n        // this.silderProgress = 0;\r\n      } else {\r\n        bgMusic.play({ src, seek: undefined }, (isSetSrc) => {\r\n          console.log('play this.ctx.paused ---2', isSetSrc);\r\n          this.canPlay = isSetSrc;\r\n        });\r\n      }\r\n      setTimeout(() => {\r\n        // 防止切换id的过程中，因为触发update，导致切换的id的时间被上一次的update替换\r\n        this.isChanging = false;\r\n      }, 500);\r\n      this.playingInfo.status = 'loading';\r\n      // ios因为要下载全部（没做切片）默认下载速度0.6m/s，1分钟音频大约为2m的大小，所以一分钟音频大概下载3.3秒\r\n      // android默认切片超时时间10秒\r\n      const timeout = isIos() ? (this.playingInfo.duration / 60) * 3.3 * 1000 : 10000;\r\n      // 如果超时（下载）时间的一半大于10秒，那么给个轻提示\r\n      const tipTime = timeout / 2 > 10000 ? 10000 : 0;\r\n      this.timeoutTimer = setTimeout(() => {\r\n        console.log('4秒后判断', this.playingInfo.status);\r\n        if (this.playingInfo.status === 'loading') {\r\n          runInAction(() => {\r\n            this.playingInfo.status = 'pause';\r\n            this.playingState = 'pause';\r\n          });\r\n        }\r\n      }, timeout);\r\n      // 轻提示\r\n      if (tipTime) {\r\n        this.tipTimer = setTimeout(() => {\r\n          console.log('10秒后轻提示', this.playingInfo.status);\r\n          if (this.playingInfo.status === 'loading') {\r\n            wx.showToast({ title: '音频加载中，请稍等...', icon: 'none', duration: 3000 });\r\n          }\r\n        }, tipTime);\r\n      }\r\n    }\r\n  }\r\n  // async startPlay(playInfo: IPlayInfo, playNow: boolean) {\r\n  async startPlay() {\r\n    console.log('startPlay', this.playInfo.object_id, this.playingInfo.object_id);\r\n    // 如果是同一个课程，说明之前暂停了，现在重新播放\r\n    if (this.playingInfo.object_id === this.playInfo.object_id) return this.goPlay();\r\n    // this.playInfo = playInfo;\r\n    this.playingInfo = this.playInfo;\r\n    this.isChanging = true;\r\n    bgMusic.setCurrentInfo(this.playingInfo);\r\n    // bgMusic.setReport()\r\n    // 获取上一次的位置\r\n    // let position = await this.getProgress(playInfo.object_id);\r\n\r\n    let position = 0;\r\n    // 如果有拖拽过\r\n    if (this.initProgress > 0) {\r\n      position = this.initProgress;\r\n      this.initProgress = 0;\r\n    }\r\n    if (position >= this.playingInfo.duration) position = 0; // 如果定位大于总时长，代表异常进度，此时置零\r\n    console.log('startPlay playInfo', toJS(this.playingInfo));\r\n    // if (this.playingInfo.object_id === this.playingInfo.object_id) {\r\n    //   // 此时同一个课程\r\n    //   if (this.playingInfo.status === 'play') {\r\n    //     this.isChanging = false;\r\n    //     // 浮窗播放，跳入详情，需要继续播放，此时音频是onCanplay状态，->\r\n    //     // -> 并不会触发onCanplay的回调，该回调，会在bgMusicTool里面触发\r\n    //     this.canPlay = true;\r\n    //     return;\r\n    //   }\r\n    // }\r\n    // if (playNow) {\r\n    //   this.playingInfo.status = 'loading';\r\n    //   bgMusic.play({ src: playInfo., seek: position }, (isSetSrc) => {\r\n    //     // 在这里设置，是因为，设置src的话，才会触发onChanplay回调\r\n    //     // 有一种是播放状态下（首页悬浮窗播放然后打开详情），不会设置src，所以不会触发onChangeplay回调\r\n    //     this.canPlay = isSetSrc;\r\n    //   });\r\n    //   console.log('触发播放');\r\n\r\n    //   setTimeout(() => {\r\n    //     // 防止切换id的过程中，因为触发update，导致切换的id的时间被上一次的update替换\r\n    //     this.isChanging = false;\r\n    //   }, 500);\r\n    //   return;\r\n    // }\r\n\r\n    // 如果不是初始化进入的，就是点击课程目录进入的\r\n    // 初始化进入的，无需直接播放\r\n    // 课程目录进入的，直接播放\r\n    this.playingInfo.status = 'loading';\r\n    this.playingState = 'loading';\r\n    bgMusic.play({ src: this.playingInfo.src, seek: position }, (isSetSrc) => {\r\n      this.canPlay = isSetSrc;\r\n    });\r\n    if (this.rate != 1) {\r\n      bgMusic.ctx.playbackRate = this.rate || 1;\r\n    }\r\n    setTimeout(() => {\r\n      this.isChanging = false;\r\n    }, 500);\r\n  }\r\n  goPause = () => {\r\n    console.log('goPause');\r\n    bgMusic.pause();\r\n    this.playingInfo.status = 'pause';\r\n  };\r\n  getProgress = async (_id?: number) => {\r\n    let position = 0;\r\n    try {\r\n      let id = `${_id}`;\r\n      const o = Taro.getStorageSync('learningProgress');\r\n      const progress = o?.[id] ?? 0;\r\n      position = progress;\r\n    } catch (error) {\r\n      console.error('getProgress error', error);\r\n    }\r\n    return position;\r\n  };\r\n  get getRate(): { rate: PlayerRate; icon: IconMap } {\r\n    return {\r\n      rate: this.rate,\r\n      icon: this.rateMap[this.rate],\r\n    };\r\n  }\r\n  /** 设置速率 */\r\n  setRate(rate: PlayerRate = 1) {\r\n    if (this.rate === rate) return console.log(`相同倍速${rate}不设置！`);\r\n    if (this.playInfo.object_id !== this.playingInfo.object_id) {\r\n      this.goPlay();\r\n      bgMusic.setRate(rate);\r\n      this.rate = rate;\r\n      return;\r\n    }\r\n    bgMusic.setRate(rate);\r\n    if (!isIos()) {\r\n      bgMusic.ctx.startTime = this.progress;\r\n      bgMusic.ctx.seek(this.progress);\r\n    }\r\n    this.rate = rate;\r\n  }\r\n  /**\r\n   * 设置定位\r\n   * @param t 时间\r\n   */\r\n  setSeek = (t: number) => {\r\n    bgMusic.setSeek(t);\r\n    this.progress = t;\r\n    this.silderProgress = t;\r\n    this.setLocalProgress(t);\r\n  };\r\n\r\n  /** 拖拽 */\r\n  onChange = (e: BaseEventOrig<SliderProps.onChangeEventDetail>) => {\r\n    console.log('onChange', this.playInfo.object_id, this.playingInfo.object_id, this.playingInfo.status);\r\n\r\n    // if (this.playInfo.object_id !== this.playingInfo.object_id && this.playingInfo.status === 'play') {\r\n    // } else {\r\n    // }\r\n    if (this.playingInfo.object_id === this.playInfo.object_id && this.playingInfo.status === 'play') {\r\n      bgMusic.setSeek(e.detail.value);\r\n    }\r\n    if (this.playingInfo.status === 'pause' || this.playingInfo.status === 'stop') {\r\n      this.initProgress = e.detail.value;\r\n    }\r\n    // 播放状态下，拖拽上报\r\n    // if (this.playingInfo.status === 'play') {\r\n    //   wx.wkAudioReport.audioDrag?.(e.detail.value);\r\n    // }\r\n\r\n    this.silderProgress = e.detail.value;\r\n    let duration = getAudioResTime();\r\n    setTimeout(() => {\r\n      this.draging = false;\r\n      console.log('设置draging', duration);\r\n    }, duration);\r\n  };\r\n\r\n  /** 拖拽中 */\r\n  // onChanging = throttle((e: BaseEventOrig<SliderProps.onChangeEventDetail>) => {\r\n  //   runInAction(() => {\r\n  //     this.draging = true;\r\n  //     this.silderProgress = e.detail.value;\r\n  //   });\r\n  // }, 14);\r\n  onChanging = (e: BaseEventOrig<SliderProps.onChangeEventDetail>) => {\r\n    this.draging = true;\r\n    this.silderProgress = e.detail.value;\r\n  };\r\n}\r\n\r\nexport const player = new Player();\r\n\r\nexport type PlayingStatus = 'pause' | 'play' | 'stop' | 'loading' | 'ended';\r\nexport type PlayerStatus = 'pause' | 'play' | 'stop' | 'loading';\r\n\r\nexport interface IPlayInfo {\r\n  /** 音频id */\r\n  object_id: number;\r\n  /** 音频url */\r\n  src: string;\r\n  /** 音频时长 */\r\n  duration: number;\r\n  /** 类型是课程还是周测 */\r\n  object_type: 'lecture' | 'form';\r\n  /** 标题 */\r\n  title: string;\r\n  /** 播放状态 */\r\n  status: PlayerStatus;\r\n  /** 主播 */\r\n  anchor: string | null;\r\n  /** 作者 */\r\n  author: string | null;\r\n  /** 书本id */\r\n  book_id: number;\r\n  /** 专栏id */\r\n  channel_id: number;\r\n  /** 0锁 1解锁 2购物车 */\r\n  unlock: 0 | 1 | 2;\r\n  /** 1听 0未听 */\r\n  unread: 0 | 1;\r\n  /** 背景图 */\r\n  cover_url: string;\r\n}\r\n\r\nexport type PlayerRate = 0.5 | 1.0 | 1.5 | 2.0;\r\n","import { IAccount } from '@/api/account/account.i';\r\nimport { makeAutoObservable } from 'mobx';\r\n\r\ntype UserType = 'new' | 'old';\r\n\r\nclass User {\r\n  /** 是否是新用户（未加入课程）0未加入 1已加入 */\r\n  userType: UserType = 'old';\r\n  /** 是否调用过登录接口 */\r\n  isLogin: boolean = false;\r\n  /** 用户信息 */\r\n  account: IAccount.UserInfo | undefined;\r\n\r\n  constructor() {\r\n    makeAutoObservable(this);\r\n  }\r\n  /** 设置是否是全新用户 */\r\n  setUserType(userType: UserType) {\r\n    this.userType = userType;\r\n  }\r\n  /** 设置音频 */\r\n  setAccount(account) {\r\n    console.log('setAccount');\r\n    if (!this.isLogin) {\r\n      this.isLogin = true;\r\n    }\r\n    this.account = account;\r\n  }\r\n}\r\n\r\nexport const user = new User();\r\n","import { throttle, jsonSort } from './tools';\r\n// throttlethrottle;\r\nexport default new (class {\r\n  querySelect(tagName) {\r\n    return new Promise((resolve, reject) => {\r\n      wx.createSelectorQuery()\r\n        .select(tagName)\r\n        .boundingClientRect()\r\n        .exec((res) => {\r\n          resolve(res);\r\n        });\r\n    });\r\n  }\r\n  /**\r\n   * 获取用户的当前设置。返回值中只会出现小程序已经向用户请求过的权限。\r\n   */\r\n  getSetting() {\r\n    return new Promise((res, rej) => {\r\n      wx.getSetting({\r\n        success(resSetting) {\r\n          res(resSetting);\r\n        },\r\n        fail(err) {\r\n          console.error('getSetting error', err);\r\n          rej(err);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  login() {\r\n    return new Promise<string>((res, rej) => {\r\n      wx.login({\r\n        success: (resLogin) => {\r\n          if (!resLogin.code) {\r\n            rej('登录失败！' + resLogin.errMsg);\r\n          }\r\n          res(resLogin.code);\r\n        },\r\n        fail(err) {\r\n          console.log(err);\r\n          rej(err);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  getUserProfile() {\r\n    return new Promise<WechatMiniprogram.GetUserProfileSuccessCallbackResult>((resolve, reject) => {\r\n      wx.getUserProfile({\r\n        desc: '用于用户身份辨别',\r\n        success: (res) => {\r\n          resolve(res);\r\n        },\r\n        fail: (e) => {\r\n          if (e?.errMsg !== 'getUserProfile:fail auth deny') {\r\n            console.error('getUserProfile fail', e);\r\n          }\r\n          reject(e);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  getUserInfo() {\r\n    return new Promise((resolve, reject) => {\r\n      wx.getUserInfo({\r\n        withCredentials: true,\r\n        success: (res) => {\r\n          resolve(res);\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * 检测code是否过期\r\n   */\r\n  checkSession() {\r\n    return new Promise((resolve, reject) => {\r\n      wx.checkSession({\r\n        success: () => {\r\n          resolve(true);\r\n        },\r\n        fail: () => {\r\n          resolve(false);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * toast弹窗\r\n   * @param {Object} {title:标题|icon:是否显示图标(默认: none)|duration:显示时长(默认: 2000)}\r\n   * @returns {Promise}\r\n   */\r\n\r\n  Toast(params: string | Toast) {\r\n    let defaultOpt = { title: '', icon: 'none', duration: 2000 };\r\n    if (!params) return console.warn('Toast 的 params 不能为空');\r\n    if (typeof params === 'string') {\r\n      // 下面这种ts不识别\r\n      // if (Object.prototype.toString.call(params) === '[object String]') {\r\n      params = { title: params, icon: 'none', duration: 2000 };\r\n    }\r\n    if (Object.prototype.toString.call(params) === '[object Object]') {\r\n      const { title = '', icon = 'none', duration = 2000 } = { ...defaultOpt, ...params };\r\n      if (!title) return;\r\n      return new Promise((res, rej) => {\r\n        wx.showToast({ title, icon, duration } as Toast);\r\n        setTimeout(() => res(true), duration);\r\n      });\r\n    }\r\n    return Promise.resolve('');\r\n  }\r\n  /**\r\n   * modal层\r\n   * @param {Object} param0 {title: 标题|content: 内容|showCancel:true 是否取消}\r\n   */\r\n  Modal<T extends ShowModalOption = ShowModalOption>(options: T) {\r\n    options = { showCancel: true, ...options };\r\n    return new Promise<boolean>((resolve, rej) => {\r\n      wx.showModal({\r\n        ...options,\r\n        success(res) {\r\n          if (res.confirm) {\r\n            resolve(true);\r\n          } else if (res.cancel) {\r\n            resolve(false);\r\n          }\r\n        },\r\n      });\r\n    });\r\n  }\r\n  // 导航----------------------------------\r\n  /** 页面回退做了优化，如果栈首是my页，就不用relaunch了 */\r\n  pageBack() {\r\n    const pages = getCurrentPages();\r\n    const currentPage = pages[pages.length - 1].route;\r\n    if (pages.length === 1) {\r\n      // 页面栈只有一个页面，而且是pay\r\n      if (currentPage === 'pages/home/home') {\r\n        return console.warn('顶层页面');\r\n      } else {\r\n        wx.reLaunch({ url: 'pages/home/home' });\r\n      }\r\n    } else {\r\n      wx.navigateBack({ delta: 1 });\r\n    }\r\n  }\r\n  /**\r\n   * 跳转\r\n   * @param { String } url 跳转地址\r\n   * @param { Object } data 跳转参数\r\n   * @returns {Promise}\r\n   */\r\n  navigateTo = throttle<(url: string, data?: any) => void>((url, data) => {\r\n    if (!url || typeof url !== 'string') {\r\n      throw new Error(`[Router.push] url 不能为空且必须是字符`);\r\n    }\r\n    // 保持原有的地址, 用于重定向是使用\r\n    let tempUrl = url;\r\n    if (data && Object.prototype.toString.call(data) === '[object Object]') {\r\n      url += `?${jsonSort(data)}`;\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      const pageArr = getCurrentPages();\r\n      console.log('开始跳转');\r\n      // 如果大于设置的页面临界值, 则用重定向, 否则正常跳转\r\n      if (pageArr.length >= 10) {\r\n        this.redirectTo(tempUrl, data)!.then(resolve).catch(reject);\r\n      } else {\r\n        wx.navigateTo({\r\n          url,\r\n          success(res) {\r\n            resolve(res);\r\n          },\r\n          fail(err) {\r\n            reject(err);\r\n          },\r\n        });\r\n      }\r\n    });\r\n  });\r\n  /**\r\n   * 重定向\r\n   * @param { String } url 跳转地址\r\n   * @param { Object } data 跳转参数\r\n   * @returns {Promise}\r\n   */\r\n  redirectTo = throttle<(url: string, data?: any) => Promise<WechatMiniprogram.GeneralCallbackResult>>((url, data) => {\r\n    if (!url || typeof url !== 'string') {\r\n      throw new Error(`[Router.redirect] url 不能为空且必须是字符`);\r\n    }\r\n    if (data && Object.prototype.toString.call(data) === '[object Object]') {\r\n      url += `?${jsonSort(data)}`;\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      wx.redirectTo({\r\n        url,\r\n        success(res) {\r\n          console.log('res--->', res);\r\n          resolve(res);\r\n        },\r\n        fail(err) {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  /**\r\n   * 页面回退\r\n   * 如果回退到栈首，那么就跳转my页\r\n   */\r\n  navigateBack = throttle((delta: number = 1) => {\r\n    wx.navigateBack({\r\n      delta,\r\n      fail: (err) => {\r\n        if (err.errMsg && err.errMsg.includes('first page')) {\r\n          // relaunch到my页面\r\n          this.reLaunch('/pages/home/home');\r\n        }\r\n      },\r\n    });\r\n  });\r\n  /**\r\n   * 删除所有页面,跳转到指定页面\r\n   * @param { String } url 跳转地址\r\n   * @param { Object } data 跳转参数\r\n   * @returns {Promise}\r\n   */\r\n  reLaunch = throttle<(url: string, data?: any) => Promise<WechatMiniprogram.GeneralCallbackResult>>((url, data) => {\r\n    if (!url || typeof url !== 'string') {\r\n      throw new Error(`[Router.reLaunch] url 不能为空且必须是字符`);\r\n    }\r\n    if (data && Object.prototype.toString.call(data) === '[object Object]') {\r\n      url += `?${jsonSort(data)}`;\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      wx.reLaunch({\r\n        url,\r\n        success(res) {\r\n          resolve(res);\r\n        },\r\n        fail(err) {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  });\r\n  /**\r\n   * 跳转到tab页\r\n   * @param { String } url 跳转地址\r\n   * @returns {Promise}\r\n   */\r\n  switchTab = throttle((url) => {\r\n    return new Promise((resolve, reject) => {\r\n      wx.switchTab({\r\n        url,\r\n        success(res) {\r\n          resolve(res);\r\n        },\r\n        fail(err) {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  });\r\n  /** 获取用户地理位置权限 */\r\n  getLocationPermission() {\r\n    return new Promise((resolve, reject) => {\r\n      wx.chooseLocation({\r\n        success(res) {\r\n          resolve(res); //调用成功直接设置地址\r\n        },\r\n        fail() {\r\n          wx.getSetting({\r\n            success(res) {\r\n              let statu = res.authSetting;\r\n              if (!statu['scope.userLocation']) {\r\n                wx.showModal({\r\n                  title: '是否授权当前位置',\r\n                  content: '需要获取您的地理位置，请确认授权，否则地图功能将无法使用',\r\n                  success(tip) {\r\n                    if (tip.confirm) {\r\n                      wx.openSetting({\r\n                        success(data) {\r\n                          if (data.authSetting['scope.userLocation'] === true) {\r\n                            wx.showToast({ title: '授权成功', icon: 'success', duration: 1000 });\r\n                            //授权成功之后，再调用chooseLocation选择地方\r\n                            wx.chooseLocation({\r\n                              success: function (res2) {\r\n                                resolve(res2);\r\n                              },\r\n                            });\r\n                          } else {\r\n                            wx.showToast({ title: '授权失败', icon: 'success', duration: 1000 });\r\n                            reject(data);\r\n                          }\r\n                        },\r\n                      });\r\n                    }\r\n                  },\r\n                });\r\n              }\r\n            },\r\n            fail(res) {\r\n              wx.showToast({ title: '调用授权窗口失败', icon: 'success', duration: 1000 });\r\n              reject(res);\r\n            },\r\n          });\r\n        },\r\n      });\r\n    });\r\n  }\r\n  /** 检查小程序更新 */\r\n  checkUpdate() {\r\n    if (wx.canIUse('getUpdateManager')) {\r\n      const updateManager = wx.getUpdateManager();\r\n      updateManager.onCheckForUpdate((res) => {\r\n        // 请求完新版本信息的回调\r\n        if (res.hasUpdate) {\r\n          updateManager.onUpdateReady(() => {\r\n            wx.showModal({\r\n              title: '更新提示',\r\n              content: '发现新版本，是否重启应用?',\r\n              cancelColor: '#999999',\r\n              confirmColor: '#FF0000',\r\n              success: (res2) => {\r\n                if (res2.confirm) {\r\n                  // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\r\n                  updateManager.applyUpdate();\r\n                }\r\n              },\r\n            });\r\n          });\r\n        }\r\n      });\r\n      updateManager.onUpdateFailed(function () {\r\n        // 新的版本下载失败\r\n        wx.showModal({\r\n          title: '提示',\r\n          content: '检查到有新版本，但下载失败，请检查网络设置',\r\n          success(res) {\r\n            if (res.confirm) {\r\n              // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\r\n              updateManager.applyUpdate();\r\n            }\r\n          },\r\n        });\r\n      });\r\n    } else {\r\n      wx.showModal({\r\n        title: '提示',\r\n        content: '当前微信版本过低，无法使用该功能，请升级到最新微信版本后重启。',\r\n      });\r\n    }\r\n  }\r\n  saveImage(url) {\r\n    wx.showLoading({ title: '保存中' });\r\n    wx.downloadFile({\r\n      url,\r\n      success(res) {\r\n        wx.saveImageToPhotosAlbum({\r\n          filePath: res.tempFilePath,\r\n          success() {\r\n            wx.showToast({\r\n              title: '保存成功',\r\n              icon: 'success',\r\n              duration: 1000,\r\n            });\r\n          },\r\n          fail() {\r\n            wx.showModal({\r\n              title: '提示',\r\n              content: '需要您授权保存相册',\r\n              showCancel: true, //是否显示取消按钮\r\n              cancelText: '否', //默认是“取消”\r\n              confirmText: '是', //默认是“确定”\r\n              success: (res2) => {\r\n                if (res2.cancel) return;\r\n                wx.openSetting({\r\n                  success(settingdata) {\r\n                    if (settingdata.authSetting['scope.writePhotosAlbum']) {\r\n                      wx.showToast({ title: '获取权限成功，再次点击图片即可保存', icon: 'none' });\r\n                    } else {\r\n                      wx.showToast({ title: '获取权限失败，将无法保存到相册哦', icon: 'none' });\r\n                    }\r\n                  },\r\n                });\r\n              },\r\n            });\r\n          },\r\n        });\r\n      },\r\n      complete() {\r\n        wx.hideLoading();\r\n      },\r\n    });\r\n  }\r\n})();\r\ntype Toast = {\r\n  title: string;\r\n  icon?: 'success' | 'error' | 'loading' | 'none';\r\n  duration?: number;\r\n  /** 自定义图标的本地路径，image 的优先级高于 icon\r\n   *\r\n   * 最低基础库： `1.1.0` */\r\n  image?: string;\r\n  /** 是否显示透明蒙层，防止触摸穿透 */\r\n  mask?: boolean;\r\n};\r\n\r\ninterface GeneralCallbackResult {\r\n  errMsg: string;\r\n}\r\ntype ShowModalCompleteCallback = (res: GeneralCallbackResult) => void;\r\ntype ShowModalFailCallback = (res: GeneralCallbackResult) => void;\r\ninterface ShowModalSuccessCallbackResult {\r\n  /** 为 true 时，表示用户点击了取消（用于 Android 系统区分点击蒙层关闭还是点击取消按钮关闭）\r\n   *\r\n   * 最低基础库： `1.1.0` */\r\n  cancel: boolean;\r\n  /** 为 true 时，表示用户点击了确定按钮 */\r\n  confirm: boolean;\r\n  /** editable 为 true 时，用户输入的文本 */\r\n  content: string;\r\n  errMsg: string;\r\n}\r\ntype ShowModalSuccessCallback = (result: ShowModalSuccessCallbackResult) => void;\r\ninterface ShowModalOption {\r\n  /** 取消按钮的文字颜色，必须是 16 进制格式的颜色字符串 */\r\n  cancelColor?: string;\r\n  /** 取消按钮的文字，最多 4 个字符 */\r\n  cancelText?: string;\r\n  /** 接口调用结束的回调函数（调用成功、失败都会执行） */\r\n  complete?: ShowModalCompleteCallback;\r\n  /** 确认按钮的文字颜色，必须是 16 进制格式的颜色字符串 */\r\n  confirmColor?: string;\r\n  /** 确认按钮的文字，最多 4 个字符 */\r\n  confirmText?: string;\r\n  /** 提示的内容，editable 为 true 时，会输入框默认文本 */\r\n  content?: string;\r\n  /** 是否显示输入框\r\n   *\r\n   * 最低基础库： `2.15.0` */\r\n  editable?: boolean;\r\n  /** 接口调用失败的回调函数 */\r\n  fail?: ShowModalFailCallback;\r\n  /** 输入框提示文本\r\n   *\r\n   * 最低基础库： `2.15.0` */\r\n  placeholderText?: string;\r\n  /** 是否显示取消按钮 */\r\n  showCancel?: boolean;\r\n  /** 接口调用成功的回调函数 */\r\n  success?: ShowModalSuccessCallback;\r\n  /** 提示的标题 */\r\n  title?: string;\r\n}\r\n","import { IPlayInfo } from '@/store/player';\r\nimport { throttle } from './tools';\r\n\r\n/**\r\n * TODO\r\n * mac:切换速率会导致重新播放，并且切换无效\r\n * ios:\r\n */\r\nexport interface AudioError {\r\n  /**\r\n   * 10001\t\t系统错误\r\n   * 10002\t\t网络错误\r\n   * 10003\t\t文件错误，请检查是否responseheader是否缺少Content-Length\r\n   * 10004\t\t格式错误\r\n   * -1\t\t未知错误\r\n   */\r\n  errCode: 10001 | 10002 | 10003 | 10004 | -1;\r\n  errMsg: any;\r\n}\r\nclass BackgroundListener {\r\n  ctx: WechatMiniprogram.BackgroundAudioManager;\r\n  systemInfo: WechatMiniprogram.SystemInfo;\r\n  isIos = false;\r\n  // 是否正在运行中\r\n  private running = false;\r\n  // 监听是否停止\r\n  private checked;\r\n  // 是否在后台\r\n  protected isAppFront = true;\r\n  constructor() {\r\n    this.ctx = wx.getBackgroundAudioManager();\r\n    this.systemInfo = wx.getSystemInfoSync();\r\n    this.isIos = /ios/gi.test(this.systemInfo?.system);\r\n    this.onListener();\r\n    // app在前台时回调\r\n    wx.onAppShow((_res) => {\r\n      this.isAppFront = true;\r\n    });\r\n    // app在后台时回调\r\n    wx.onAppHide((_res) => {\r\n      this.isAppFront = false;\r\n    });\r\n  }\r\n  private _onError: Function = () => {};\r\n  private _onPrev: Function = () => {};\r\n  private _onNext: Function = () => {};\r\n  private _onCanplay: Function = () => {};\r\n  private _onTimeUpdate: Function = () => {};\r\n  private _onEnded: Function = () => {};\r\n  private _onStop: Function = () => {};\r\n  private _onPause: Function = () => {};\r\n  private _onPlay: Function = () => {};\r\n  private _onWaiting: Function = () => {};\r\n  private _onSeeked: Function = () => {};\r\n  private _onSeeking: Function = () => {};\r\n\r\n  private onListener() {\r\n    this.ctx.onError((e) => {\r\n      console.log('eeeee', e);\r\n\r\n      this.onErrorHandler(e);\r\n    });\r\n    this.ctx.onNext(() => this.onNextHandler());\r\n    this.ctx.onPrev(() => this.onPrevHandler());\r\n    this.ctx.onCanplay(() => this.onCanplayHandler());\r\n    this.ctx.onPlay(() => this.onPlayHandler());\r\n    this.ctx.onPause(() => this.onPauseHandler());\r\n    this.ctx.onStop(() => this.onStopHandler());\r\n    this.ctx.onEnded(() => this.onEndedHandler());\r\n    this.ctx.onTimeUpdate(() => this.onTimeUpdateHandler());\r\n    // 小程序音频后台补偿器，切换后台后this.ctx.onTimeUpdate不会触发，这里用于补偿this.ctx.onTimeUpdate的触发\r\n    wx.wkOnAudioTimeUpdate = () => this.onTimeUpdateHandler();\r\n    this.ctx.onWaiting(() => this.onWaitingHandler());\r\n    this.ctx.onSeeked(() => {\r\n      console.log('this.onSeekedHandler()');\r\n\r\n      this.onSeekedHandler();\r\n    });\r\n    this.ctx.onSeeking(() => this.onSeekingHandler());\r\n  }\r\n  protected onPrevHandler() {\r\n    this.onPrevCallback(this._onPrev);\r\n  }\r\n  protected onErrorHandler(e) {\r\n    this.onErrorCallback(this._onError, e);\r\n  }\r\n  protected onNextHandler() {\r\n    this.onNextCallback(this._onNext);\r\n  }\r\n  protected onCanplayHandler() {\r\n    this.onCanplayCallback(this._onCanplay);\r\n  }\r\n  protected onPlayHandler() {\r\n    this.onPlayCallback(this._onPlay);\r\n  }\r\n  protected onPauseHandler() {\r\n    this.running = false;\r\n    this.onPauseCallback(this._onPause);\r\n  }\r\n  protected onStopHandler() {\r\n    this.running = false;\r\n    this.onStopCallback(this._onStop);\r\n  }\r\n  protected onEndedHandler() {\r\n    this.onEndedCallback(this._onEnded);\r\n  }\r\n  protected onTimeUpdateHandler() {\r\n    this.running = true;\r\n    if (!this.checked) {\r\n      // 场景，该场景为后台暂停音频，但是没有触发音频暂停回调，并且没有触发update，这里默认为已经暂停，所以默认回调一次停止事件\r\n      this.checked = true;\r\n      setTimeout(() => {\r\n        this.checked = false;\r\n        console.log('手动暂停', this.ctx.paused, this.running, !this.isAppFront);\r\n        if (this.ctx.paused && this.running && !this.isAppFront) {\r\n          this._onPause(); // 手动调用暂停\r\n        }\r\n      }, 2000);\r\n    }\r\n    this.onTimeUpdateCallback(this._onTimeUpdate);\r\n  }\r\n  protected onWaitingHandler() {\r\n    this.onWaitingCallback(this._onWaiting);\r\n  }\r\n  protected onSeekedHandler() {\r\n    this.onSeekedCallback(this._onSeeked);\r\n  }\r\n  protected onSeekingHandler() {\r\n    this.onSeekingCallback(this._onSeeking);\r\n  }\r\n  public removeListener = () => {\r\n    this._onCanplay = () => {};\r\n    this._onTimeUpdate = () => {};\r\n    this._onEnded = () => {};\r\n    this._onStop = () => {};\r\n    this._onPause = () => {};\r\n    this._onPlay = () => {};\r\n    this._onWaiting = () => {};\r\n    this._onSeeked = () => {};\r\n    this._onSeeking = () => {};\r\n  };\r\n  protected onErrorCallback = (next, error) => next(error);\r\n  protected onNextCallback = (next) => next();\r\n  protected onPrevCallback = (next) => next();\r\n  protected onCanplayCallback = (next) => next();\r\n  protected onPlayCallback = (next) => next();\r\n  protected onPauseCallback = (next) => next();\r\n  protected onStopCallback = (next) => next();\r\n  protected onEndedCallback = (next) => next();\r\n  protected onTimeUpdateCallback = (next) => next();\r\n  protected onWaitingCallback = (next) => next();\r\n  protected onSeekedCallback = (next) => next();\r\n  protected onSeekingCallback = (next) => next();\r\n\r\n  /**\r\n   * 是否能够播放\r\n   * @param callback 是否能播放回调\r\n   */\r\n  public onCanplay(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onCanplay 入参必须是函数类型');\r\n    this._onCanplay = callback;\r\n  }\r\n  public onPlay(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onPlay 入参必须是函数类型');\r\n    this._onPlay = callback;\r\n  }\r\n  public onPause(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onPause 入参必须是函数类型');\r\n    this._onPause = callback;\r\n  }\r\n  public onStop(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onStop 入参必须是函数类型');\r\n    this._onStop = callback;\r\n  }\r\n  public onEnded(callback: (isEnded: boolean) => void) {\r\n    if (typeof callback !== 'function') return console.warn('onEnded 入参必须是函数类型');\r\n    this._onEnded = callback;\r\n  }\r\n\r\n  public onError(callback: (error: AudioError) => void) {\r\n    if (typeof callback !== 'function') return console.warn('onError 入参必须是函数类型');\r\n    this._onError = callback;\r\n  }\r\n  public onTimeUpdate(callback: (e: { currentTime: number }) => void) {\r\n    if (typeof callback !== 'function') return console.warn('onTimeUpdate 入参必须是函数类型');\r\n    this._onTimeUpdate = callback;\r\n  }\r\n  public onWaiting(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onWaiting 入参必须是函数类型');\r\n    this._onWaiting = callback;\r\n  }\r\n  public onSeeked(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onSeeked 入参必须是函数类型');\r\n    this._onSeeked = callback;\r\n  }\r\n  public onSeeking(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onSeeking 入参必须是函数类型');\r\n    this._onSeeking = callback;\r\n  }\r\n  public onNext(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onNext 入参必须是函数类型');\r\n    this._onNext = callback;\r\n  }\r\n  public onPrev(callback: Function) {\r\n    if (typeof callback !== 'function') return console.warn('onPrev 入参必须是函数类型');\r\n    this._onPrev = callback;\r\n  }\r\n}\r\n\r\nclass BackgroundMusic extends BackgroundListener {\r\n  // 当前进度\r\n  currentSeek = 0;\r\n  // 是否在播放中\r\n  isPlaying = false;\r\n  // 设置rate的回调\r\n  setRateCallback?: Function;\r\n  // 设置seek的回调\r\n  setSeekCallback = () => {};\r\n  currentInfo?: IPlayInfo;\r\n  public setCurrentInfo(info: IPlayInfo) {\r\n    this.currentInfo = info;\r\n  }\r\n  public setReport(options: { channel_id: number; lecture_id: number }) {\r\n    this.ctx.reportData = {\r\n      evt: 'le_play',\r\n      element: 'player__audio',\r\n      evt_params: {\r\n        ch_id: options.channel_id,\r\n        lec_id: options.lecture_id,\r\n      },\r\n    };\r\n    //  {\r\n    //   evt: 'le_play',\r\n    //   element: 'player__audio',\r\n    //   evt_params: {\r\n    //     ch_id: props.channel_id,\r\n    //     lec_id: props.lecture_id,\r\n    //   },\r\n    // };\r\n  }\r\n  startCallback: Function = () => {};\r\n  /**\r\n   * 设置地址\r\n   * @param src 地址\r\n   */\r\n  public setSrc(src: string) {\r\n    this.isPlaying = false;\r\n    console.log('====================================');\r\n    console.log(\r\n      '设置src',\r\n      src,\r\n      this.currentInfo?.title,\r\n      this.currentInfo?.cover_url,\r\n      this.currentInfo,\r\n      this.currentInfo?.title,\r\n      this.ctx,\r\n      this.ctx.paused\r\n    );\r\n    console.log('====================================');\r\n    this.ctx.startTime = 0;\r\n    this.ctx.currentTime = 0;\r\n    this.ctx.src = src;\r\n    this.ctx.title = this.currentInfo?.title ?? '梨花听书';\r\n    this.ctx.coverImgUrl = this.currentInfo?.cover_url ?? '';\r\n    // this.startCallback = () => {\r\n    //   console.log('开始设置src');\r\n    //   setTimeout(() => {\r\n    //     this.ctx.src = src;\r\n    //     this.ctx.title = new Date().getTime() + '';\r\n    //     this.startCallback = () => {};\r\n    //   }, 200);\r\n    // };\r\n    // if (this.ctx.paused !== undefined && this.ctx.paused === false) {\r\n    //   console.log('强制stop');\r\n    //   this.ctx.stop();\r\n    //   this.ctx.startTime = 0;\r\n    //   this.ctx.currentTime = 0;\r\n    // } else {\r\n    //   this.startCallback?.();\r\n    // }\r\n  }\r\n  public stop() {\r\n    // 如果偶遇src代表非stop状态，可以触发stop\r\n    if (this.ctx.src) {\r\n      this.ctx.stop();\r\n    }\r\n  }\r\n  /**\r\n   * 音频播放\r\n   * @param src 音频url\r\n   * @param seek 音频播放位置\r\n   * @param isSetSrcCallback 是否是设置src的play\r\n   */\r\n  public play({ src, seek }: { src: string; seek?: number }, isSetSrcCallback: (isSetSrc: boolean) => void = () => {}) {\r\n    console.log('play this.ctx.paused', !!src && this.ctx.src === src, src, seek, this.ctx.paused, this.ctx.src);\r\n    if (!this.ctx.reportData) console.warn('reportData参数缺失，需要设置setReport否则无法触发update补帧功能（wx.wkOnAudioTimeUpdate）');\r\n\r\n    // 如果之前没有src，就走初始化的操作\r\n    if (!!src && this.ctx.src === src) {\r\n      isSetSrcCallback?.(true);\r\n      this.ctx.play();\r\n    } else {\r\n      console.log('设置src', this.setSrc, src);\r\n      this.ctx.playbackRate = 1;\r\n      isSetSrcCallback?.(false);\r\n      this.setSrc(src);\r\n    }\r\n    console.log(\r\n      'seek !== undefined && seek !== this.ctx.currentTime',\r\n      seek,\r\n      this.ctx.currentTime,\r\n      seek !== undefined,\r\n      seek !== this.ctx.currentTime\r\n    );\r\n\r\n    // if (seek !== undefined && seek !== this.ctx.currentTime) {\r\n    // if (seek !== undefined) {\r\n    seek = seek ?? 0; // 如果seek为undefined就默认为0， 处理20210918出现的onEnded后置0，播放this.ctx.currentTime仍然为之前的位置的bug\r\n    if (!!src && this.ctx.src === src) {\r\n      // 这里属于无需重新替换src播放\r\n      this.ctx.currentTime = seek;\r\n      this.ctx.startTime = seek; // TODO 这个可能去掉\r\n      this.ctx.seek(seek);\r\n\r\n      console.log('我触发了onPlay1');\r\n      this.ctx.play(); // TODO 这里其实不用加，但是存在设置前触发了stop的情况\r\n    } else {\r\n      console.log('我设置了回调setSeekCallback');\r\n      // 这里属于替换src的操作\r\n      this.setSeekCallback = () => {\r\n        seek = seek ?? 0; // 防止typescript类型校验错误\r\n        console.log('setSeekCallback', seek);\r\n        this.currentSeek = seek;\r\n        this.ctx.currentTime = seek;\r\n        this.ctx.startTime = seek;\r\n        this.ctx.seek(seek); // 这个可能去掉\r\n        console.log('我触发了onPlay2');\r\n        this.ctx.play(); // TODO 这里其实不用加，但是存在设置前触发了stop的情况\r\n        this.setSeekCallback = () => {};\r\n      };\r\n    }\r\n    // }\r\n    // if (!this.ctx.src) {\r\n    //   this.setSrc(src);\r\n    //   // this.ctx.play();\r\n    //   if (this.currentSeek > 0) {\r\n    //     this.setSeek(this.currentSeek);\r\n    //   }\r\n    // } else {\r\n    //   // 如果src是上一次的，也就是说没有更换音频\r\n    //   if (this.ctx.src === src) {\r\n    //     this.ctx.play();\r\n    //   } else {\r\n    //     // 如果src不是上一次的，代表更换音频\r\n    //     this.setSrc(src);\r\n    //     this.currentSeek = 0;\r\n    //   }\r\n    // }\r\n    // TODO 判断src是不是相同，判断是否在播放状态\r\n  }\r\n  public pause() {\r\n    // if(this.ctx.paused)\r\n    console.log('pause this.ctx.paused', this.ctx.paused);\r\n    this.ctx.pause();\r\n  }\r\n  /**\r\n   * 设置速率\r\n   * 注：开发工具上，都是用的ios的模式，会导致如果使用android模拟器，设置速率无效\r\n   * @param rate 速率\r\n   */\r\n  public setRate(rate: number | string) {\r\n    console.log('setRate', this.isIos, +rate || 1);\r\n    if (this.isIos) {\r\n      // ios想改变速率得重新设置src\r\n      // https://developers.weixin.qq.com/community/develop/doc/000c629406cd4075ce4cee9855b800?highLine=BackgroundAudioManager%2520playbackRate\r\n      const src = this.ctx.src;\r\n      const currentSeek = this.currentSeek;\r\n      this.setRateCallback = () => {\r\n        // this.ctx.startTime = this.currentSeek;\r\n        this.setSrc(src);\r\n        this.ctx.playbackRate = +rate || 1;\r\n        console.log('当前速率', +rate || 1, this.currentSeek, currentSeek, src);\r\n        this.ctx.startTime = currentSeek;\r\n        this.ctx.seek(currentSeek);\r\n        this.setRateCallback = undefined;\r\n      };\r\n      this.ctx.stop();\r\n    } else {\r\n      // this.rateFix();\r\n      console.log('setRate---->', Date.now());\r\n      this.ctx.playbackRate = +rate || 1;\r\n    }\r\n  }\r\n  rateFxCallback = () => {};\r\n  private rateFix() {\r\n    // 先拿到是否是暂停状态\r\n    const needFix = this.ctx.paused;\r\n    this.rateFxCallback = () => {\r\n      if (needFix) {\r\n        this.ctx.pause();\r\n      }\r\n      this.rateFxCallback = () => {};\r\n    };\r\n  }\r\n  /**\r\n   * 设置进度\r\n   * @param seek 进度\r\n   */\r\n  public setSeek(seek: number) {\r\n    console.log('设置了进度', seek, this.isPlaying);\r\n    this.currentSeek = seek;\r\n    this.ctx.seek(seek);\r\n  }\r\n  /** 音频播放失败 */\r\n  protected onErrorCallback = (next, error) => {\r\n    wx.showToast({ title: '音频播放失败', icon: 'none' });\r\n    next(error);\r\n  };\r\n  /**\r\n   * 监听用户在系统音乐播放面板点击上一曲事件\r\n   */\r\n  protected onPrevCallback = (next) => {\r\n    next();\r\n  };\r\n  /**\r\n   * 监听用户在系统音乐播放面板点击下一曲事件\r\n   */\r\n  protected onNextCallback = (next) => {\r\n    next();\r\n  };\r\n  // 所有on回调都没有e，得自己封装，next就是传递到对应页面注册回调\r\n  /**\r\n   * @override\r\n   */\r\n  protected onCanplayCallback = (next) => {\r\n    console.log('onCanplayCallback', this.ctx.currentTime);\r\n    this.setSeekCallback();\r\n    next();\r\n  };\r\n  protected onPlayCallback = (next) => {\r\n    console.log('onPlayCallback', this.ctx.currentTime, Date.now());\r\n    next();\r\n  };\r\n  protected onPauseCallback = (next) => {\r\n    this.isPlaying = false;\r\n    console.log('onPauseCallback', this.ctx.currentTime);\r\n    next();\r\n  };\r\n  protected onStopCallback = (next) => {\r\n    this.isPlaying = false;\r\n    console.log('onStopCallback', this.ctx.currentTime);\r\n    this.startCallback?.();\r\n    // ios设置rate需要先stop后再设置rate再设置src\r\n    // 因为ios下的setRateCallback内部会触发一个暂停，这是非正常暂停，所以不需要反馈给前端\r\n    if (this.setRateCallback) {\r\n      this.setRateCallback();\r\n    } else {\r\n      next();\r\n    }\r\n  };\r\n  protected onEndedCallback = (next) => {\r\n    this.isPlaying = false;\r\n    console.log('onEndedCallback', this.ctx, this.ctx.duration, this.ctx.currentTime);\r\n    this.setSeek(0);\r\n    next(Math.abs(this.ctx.duration - this.ctx.currentTime) <= 1);\r\n  };\r\n  protected onTimeUpdateCallback = (next) => {\r\n    // console.log('onTimeUpdateCallback', this.ctx.currentTime, this.ctx.paused);\r\n    // TODO 此处拦截，但是不保险，拦截原因，\r\n    // 比如onEnded后会多触发一次update，但此时的paused是true，\r\n    // 正常的情况下是false\r\n    // console.log('onTimeUpdateCallback', this.ctx.paused, this.ctx);\r\n\r\n    if (this.ctx.paused) return console.log('此处拦截update');\r\n    this.isPlaying = true;\r\n    this.currentSeek = this.ctx.currentTime;\r\n    next({ currentTime: this.ctx.currentTime });\r\n  };\r\n  protected onSeekingCallback = (next) => {\r\n    console.log('onSeekingCallback');\r\n    next();\r\n  };\r\n  protected onSeekedCallback = (next) => {\r\n    console.log('onSeekedCallback', Date.now());\r\n    next();\r\n  };\r\n  protected onWaitingCallback = (next) => {\r\n    console.log('onWaitingCallback', Date.now());\r\n    next();\r\n  };\r\n}\r\nexport type BackgroundMusicType = BackgroundMusic;\r\nexport default new BackgroundMusic();\r\n","import ReactCSSModule from 'react-css-modules';\r\n\r\ninterface TypeOptions {\r\n  allowMultiple?: boolean | undefined;\r\n  handleNotFoundStyleName?: 'throw' | 'log' | 'ignore' | undefined;\r\n}\r\nexport const CSSModule = <C extends Function>(Component: C, defaultStyles: any, options?: TypeOptions) => {\r\n  if (!options) {\r\n    options = {\r\n      // https://github.com/gajus/react-css-modules#allowmultiple\r\n      allowMultiple: true, //允许多个 CSS 模块名称。\r\n      /**\r\n       * 定义styleName无法映射到现有 CSS 模块时所需的操作。\r\n        throw 抛出错误\r\n        log 使用记录警告 console.warn\r\n        ignore 默默地忽略缺少的样式名称\r\n       */\r\n      handleNotFoundStyleName: 'ignore',\r\n    };\r\n  }\r\n  return ReactCSSModule<C>(Component, defaultStyles, options);\r\n};\r\n","import { axios, AxiosRequestConfig as IAxiosRequestConfig } from 'taro-axios';\r\nimport { fetchError, fetchSuccess, getApiUrl, getUrlApiName, httpRequestHandler } from '@/utils/tools';\r\nimport { getToken } from './login';\r\nimport { baseUrl } from '@/config/config';\r\n\r\ntype AxiosRequestConfig = IAxiosRequestConfig;\r\nexport { AxiosRequestConfig };\r\n\r\nexport let url = {\r\n  wk: `${baseUrl.main}/api`,\r\n  /** 听书 /v1/integration/wk_business_lihuats*/\r\n  base: `${baseUrl.gw}/v1/integration/lh_tingshu_business`,\r\n  // base: `${baseUrl.gw}/v1/integration/wk_business_lihuats`, // 微课旧版本\r\n  /** 周测 */\r\n  gw: `${baseUrl.gw}/v1`,\r\n  middleground: `${baseUrl.middleground}/api`,\r\n};\r\n\r\nconst http = axios.create();\r\nexport { http };\r\n\r\nhttp.interceptors.request.use(\r\n  (config) => {\r\n    console.log(`%c 发送 ${getUrlApiName(config.url)} `, 'background:#62D438;color:#333', config);\r\n    httpRequestHandler(config);\r\n    // const api = getApiUrl(config.url);\r\n    // console.report(`http_request ${api}`, config.data || {});\r\n    return config;\r\n  },\r\n  (err) => {\r\n    // console.error(err);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\nhttp.interceptors.response.use(\r\n  function (res) {\r\n    return new Promise((resolve, reject) => {\r\n      let response: any = res.data;\r\n      // console.log(response);\r\n\r\n      const api = getApiUrl(res?.config?.url);\r\n      if (response.code !== 0 && response.code !== '0000' && response.code !== 40101 && response.code !== 40102) {\r\n        fetchError(res, api, res.data?.data);\r\n        response.isReport = true;\r\n        return reject(response);\r\n      }\r\n      console.log(`%c 接收 ${getUrlApiName(res.config.url)} `, 'background:#1E1E1E;color:#bada55', res);\r\n      // fetchSuccess(res, api);\r\n      return resolve(response.data);\r\n    });\r\n  },\r\n  (error) => {\r\n    console.error('http_catch', error);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport function get<T>(apiUrl: string, params?: { [key: string]: any }, config?: AxiosRequestConfig) {\r\n  return new Promise<T>((res, rej) => {\r\n    if (params) params = { params }; // get 请求接收一个params对象\r\n    if (config) params = Object.assign(params, config);\r\n    // 如果不需要登录态的\r\n    if (params?.params?.noaccess) {\r\n      delete params?.params?.noaccess; // 删掉，以免影响数据\r\n      return res(http.get<T>(apiUrl, params));\r\n    }\r\n    getToken(\r\n      () => res(http.get<T>(apiUrl, params)),\r\n      () => {\r\n        console.log('没有token', apiUrl);\r\n        rej({ code: '0401' });\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nexport function post<T>(apiUrl: string, params?: { [key: string]: any }, config?: AxiosRequestConfig) {\r\n  return new Promise<T>((res, rej) => {\r\n    if (params?.noaccess) {\r\n      delete params?.noaccess; // 删掉，以免影响数据\r\n      return res(http.post<T>(apiUrl, params, config));\r\n    }\r\n    getToken(\r\n      () => res(http.post<T>(apiUrl, params, config)),\r\n      () => {\r\n        rej({ code: '0401' });\r\n      }\r\n    );\r\n  });\r\n}\r\n","/*\r\n * @Description: 登录逻辑\r\n * @LastEditTime: 2021-09-15 09:56:28\r\n */\r\nimport { api_weixin_mina_v2 } from '@/api/account/account';\r\nimport { IAccount } from '@/api/account/account.i';\r\nimport { getStorage, removeStorage, setStorage } from './tools';\r\nimport WX from './WX';\r\nimport { storageUtil } from './storage';\r\nimport { track } from './track';\r\nimport { ApiStore } from '@/store';\r\n\r\nconst callbackQueue: { onSuccess: Function; onFailed: Function }[] = [];\r\nlet isProcessing = false;\r\n\r\nexport async function getToken(onSuccess?, onFailed?) {\r\n  try {\r\n    let token = getStorage('token');\r\n    if (token) return onSuccess?.(token);\r\n    if (isProcessing) return callbackQueue.push({ onSuccess, onFailed });\r\n    isProcessing = true;\r\n    console.log('getToken', callbackQueue);\r\n    storageUtil.clear();\r\n    const res = await httpCheckLogin();\r\n    isProcessing = false;\r\n    while (callbackQueue.length) {\r\n      const cb = callbackQueue.shift();\r\n      if (cb) {\r\n        if (!res.is_new) {\r\n          cb.onSuccess?.(res.access_token);\r\n          onSuccess?.(res.access_token);\r\n        } else {\r\n          cb.onFailed?.();\r\n          onFailed?.();\r\n        }\r\n      }\r\n    }\r\n    if (!res.is_new) {\r\n      callbackQueue.forEach(({ onSuccess: os }) => os?.());\r\n      onSuccess?.(res.access_token);\r\n    } else {\r\n      callbackQueue.forEach(({ onFailed: of }) => of?.());\r\n      onFailed?.();\r\n    }\r\n  } catch (error) {\r\n    console.error('getToken error', error);\r\n  }\r\n}\r\n/** 登录设置token */\r\nexport async function httpCheckLogin(params?: { iv: string; encryptedData: string }) {\r\n  try {\r\n    const code = await WX.login();\r\n    const data: IAccount.params = {\r\n      code,\r\n      mtype: 'lihuats',\r\n    };\r\n    if (params) {\r\n      data.iv = params.iv;\r\n      data.encryptedData = params.encryptedData;\r\n    }\r\n    const info = await api_weixin_mina_v2(data);\r\n    console.log('重新登录 info', info);\r\n    ApiStore.user.setAccount(info.userinfo);\r\n    if (info && !info.is_new) {\r\n      setStorage('token', info.access_token, { expires: 1000 * 60 * 60 * 5 });\r\n      setStorage('account', info.userinfo);\r\n      track.initEvent(); // 登录后初始化埋点\r\n    }\r\n    return Promise.resolve(info);\r\n  } catch (error) {\r\n    console.error('httpCheckLogin error', error);\r\n    wx.showToast({\r\n      title: '请求超时，请点击右上角...重新进入小程序',\r\n      icon: 'none',\r\n    });\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n","/*\r\n * @Description: TODO:数据缓存\r\n * @Date: 2021-09-10 19:03:50\r\n * @LastEditTime: 2021-09-15 16:26:16\r\n */\r\n\r\nimport { setStorage, getStorage, removeStorage } from '@/utils/tools';\r\n\r\ntype IStorageData = {\r\n  [key in IStorage]: any;\r\n};\r\ntype IStorage =\r\n  | 'token'\r\n  | 'account'\r\n  | 'setIsSubscribe'\r\n  | 'closeCard'\r\n  | 'setIsAccess'\r\n  | 'set_fomate_daily_content'\r\n  | 'setChannelId'\r\n  | 'subscriptionMsg'\r\n  | 'setWithdrawIng'\r\n  | 'learningProgress'\r\n  | 'float_play'\r\n  | 'setClockMsg'\r\n  | 'setPlayRate'\r\n  | 'test';\r\n\r\ninterface IStorageConfig {\r\n  /** 设置失效时间 */\r\n  expires?: number;\r\n}\r\n\r\nclass DataStorage {\r\n  private whiteList: string[] = ['subscriptionMsg', 'closeCard'];\r\n  storage: IStorageData = {\r\n    token: '',\r\n    account: '',\r\n    // 是否订阅公众号\r\n    setIsSubscribe: '',\r\n    // 是否关闭已领取的亲友卡\r\n    closeCard: '',\r\n    // 用户是否加入专栏\r\n    setIsAccess: '',\r\n    // 课程列表\r\n    set_fomate_daily_content: '',\r\n    // 专栏id\r\n    setChannelId: '',\r\n    // 订阅消息\r\n    subscriptionMsg: '',\r\n    // 是否提现\r\n    setWithdrawIng: '',\r\n    //学习进度\r\n    learningProgress: '',\r\n    // 播放悬浮窗\r\n    float_play: '',\r\n    setClockMsg: '',\r\n    setPlayRate: '',\r\n    test: '',\r\n  };\r\n\r\n  init() {\r\n    for (let key in this.storage) {\r\n      if (Object.prototype.hasOwnProperty.call(this.storage, key)) {\r\n        Object.defineProperty(this.storage, key, {\r\n          get: function () {\r\n            return getStorage(key);\r\n          },\r\n          set: function (value: any) {\r\n            setStorage(key, value);\r\n          },\r\n          enumerable: true,\r\n          configurable: true,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  setStorage(key, value, config: IStorageConfig = {}) {\r\n    setStorage(key, value, config);\r\n  }\r\n\r\n  clear() {\r\n    for (let key in this.storage) {\r\n      if (Object.prototype.hasOwnProperty.call(this.storage, key)) {\r\n        if (this.whiteList.indexOf(key) === -1) {\r\n          removeStorage(key);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const storageUtil = new DataStorage();\r\n","import type { AxiosRequestConfig, AxiosResponse } from 'taro-axios';\r\nimport dateFormatPlugin from '@/libs/date-format';\r\nimport qs from 'qs';\r\nimport { IChannelDailyContentGet } from '@/api/content/content.i';\r\nimport { api_judge_subscribed } from '@/api/account/account';\r\n\r\nexport type ActivePage = WechatMiniprogram.Page.Instance<WechatMiniprogram.IAnyObject, WechatMiniprogram.IAnyObject>;\r\n/** 获取当前page */\r\nconst getActivePage = (): ActivePage => {\r\n  const curPages = getCurrentPages();\r\n  if (curPages.length) {\r\n    return curPages[curPages.length - 1];\r\n  }\r\n  return {} as ActivePage;\r\n};\r\nfunction isObject(value: any): boolean {\r\n  const type = typeof value;\r\n  return value != null && (type == 'object' || type == 'function');\r\n}\r\ninterface DebouncedFunc<T extends (...args: any[]) => any> {\r\n  (...args: Parameters<T>): ReturnType<T> | undefined;\r\n  cancel(): void;\r\n  flush(): ReturnType<T> | undefined;\r\n}\r\ninterface DebounceOptions {\r\n  /** 立即执行 */\r\n  leading?: boolean;\r\n  /** 最大等待时间 */\r\n  maxWait?: number;\r\n  /** 最后一次也要执行，多用于节流 */\r\n  trailing?: boolean;\r\n}\r\n/**\r\n * 防抖\r\n * @example\r\n * ```\r\n * debounce<(progress: number) => void>(progress => {}, 40)\r\n * ```\r\n */\r\nfunction debounce<T extends (...args: any) => any>(func: T, wait: number = 0, options?: DebounceOptions): DebouncedFunc<T> {\r\n  let lastArgs: IArguments | undefined,\r\n    lastThis: any,\r\n    maxWait: number | undefined,\r\n    result: any,\r\n    timerId: NodeJS.Timeout | undefined,\r\n    lastCallTime: number | undefined,\r\n    lastInvokeTime = 0,\r\n    leading = false,\r\n    maxing = false,\r\n    trailing = true;\r\n\r\n  if (typeof func != 'function') {\r\n    throw new Error('回调必须是函数');\r\n  }\r\n  wait = +wait || 0;\r\n  if (options && isObject(options)) {\r\n    leading = !!options?.leading;\r\n    maxing = 'maxWait' in options;\r\n    maxWait = maxing ? Math.max(+(options?.maxWait ?? 0) || 0, wait) : maxWait;\r\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\r\n  }\r\n\r\n  function invokeFunc(time: number) {\r\n    let args = lastArgs,\r\n      thisArg = lastThis;\r\n\r\n    lastArgs = lastThis = undefined;\r\n    lastInvokeTime = time;\r\n    result = func.apply(thisArg, args as unknown as any[]);\r\n    return result;\r\n  }\r\n\r\n  function leadingEdge(time: number) {\r\n    // Reset any `maxWait` timer.\r\n    lastInvokeTime = time;\r\n    // Start the timer for the trailing edge.\r\n    timerId = setTimeout(timerExpired, wait);\r\n    // Invoke the leading edge.\r\n    return leading ? invokeFunc(time) : result;\r\n  }\r\n\r\n  function remainingWait(time: number) {\r\n    let timeSinceLastCall = time - (lastCallTime as number),\r\n      timeSinceLastInvoke = time - lastInvokeTime,\r\n      timeWaiting = wait - timeSinceLastCall;\r\n\r\n    return maxing ? Math.min(timeWaiting, (maxWait as number) - timeSinceLastInvoke) : timeWaiting;\r\n  }\r\n\r\n  function shouldInvoke(time: number) {\r\n    let timeSinceLastCall = time - (lastCallTime as number),\r\n      timeSinceLastInvoke = time - lastInvokeTime;\r\n\r\n    // Either this is the first call, activity has stopped and we're at the\r\n    // trailing edge, the system time has gone backwards and we're treating\r\n    // it as the trailing edge, or we've hit the `maxWait` limit.\r\n    return (\r\n      lastCallTime === undefined ||\r\n      timeSinceLastCall >= wait ||\r\n      timeSinceLastCall < 0 ||\r\n      (maxing && timeSinceLastInvoke >= (maxWait as number))\r\n    );\r\n  }\r\n\r\n  function timerExpired() {\r\n    let time = Date.now();\r\n    if (shouldInvoke(time)) {\r\n      return trailingEdge(time);\r\n    }\r\n    // Restart the timer.\r\n    timerId = setTimeout(timerExpired, remainingWait(time));\r\n  }\r\n\r\n  function trailingEdge(time: number) {\r\n    timerId = undefined;\r\n\r\n    // Only invoke if we have `lastArgs` which means `func` has been\r\n    // debounced at least once.\r\n    if (trailing && lastArgs) {\r\n      return invokeFunc(time);\r\n    }\r\n    lastArgs = lastThis = undefined;\r\n    return result;\r\n  }\r\n\r\n  function cancel() {\r\n    if (timerId !== undefined) {\r\n      clearTimeout(timerId);\r\n    }\r\n    lastInvokeTime = 0;\r\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\r\n  }\r\n\r\n  function flush() {\r\n    return timerId === undefined ? result : trailingEdge(Date.now());\r\n  }\r\n\r\n  function debounced(this: any) {\r\n    let time = Date.now(),\r\n      isInvoking = shouldInvoke(time);\r\n\r\n    lastArgs = arguments;\r\n    lastThis = this;\r\n    lastCallTime = time;\r\n\r\n    if (isInvoking) {\r\n      if (timerId === undefined) {\r\n        return leadingEdge(lastCallTime);\r\n      }\r\n      if (maxing) {\r\n        // Handle invocations in a tight loop.\r\n        clearTimeout(timerId);\r\n        timerId = setTimeout(timerExpired, wait);\r\n        return invokeFunc(lastCallTime);\r\n      }\r\n    }\r\n    if (timerId === undefined) {\r\n      timerId = setTimeout(timerExpired, wait);\r\n    }\r\n    return result;\r\n  }\r\n  debounced.cancel = cancel;\r\n  debounced.flush = flush;\r\n  return debounced;\r\n}\r\ninterface ThrottleOptions {\r\n  /** 默认值 true 立即执行 */\r\n  leading?: boolean;\r\n  /** 默认值 true 最后一次也要执行，多用于节流 */\r\n  trailing?: boolean;\r\n}\r\n/**\r\n * 节流\r\n * @example\r\n * ```\r\n * throttle<(progress: number) => void>(progress => {}, 40)\r\n * ```\r\n */\r\nfunction throttle<T extends (...args: any) => any>(func: T, wait?: number, options?: ThrottleOptions): DebouncedFunc<T> {\r\n  let leading = true,\r\n    trailing = true;\r\n  if (wait === undefined) wait = 300;\r\n  if (typeof func != 'function') {\r\n    throw new Error('回调必须是函数');\r\n  }\r\n  if (options && isObject(options)) {\r\n    leading = 'leading' in options ? !!options.leading : leading;\r\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\r\n  }\r\n  return debounce(func, wait, {\r\n    leading: leading,\r\n    maxWait: wait,\r\n    trailing: trailing,\r\n  });\r\n}\r\n\r\n/**\r\n * @desc 对象Key排序并生成key=value&\r\n * @param {Object} jsonObj 排序对象\r\n * @param {Boolean} isSort 是否排序\r\n */\r\nfunction jsonSort(jsonObj: { [key: string]: any }, isSort = false) {\r\n  let arr: string[] = [];\r\n  for (let key in jsonObj) {\r\n    if (jsonObj.hasOwnProperty(key)) arr.push(key);\r\n  }\r\n  isSort && arr.sort();\r\n  let str = '';\r\n  for (let i in arr) {\r\n    // 过滤掉 Array.prototype.xxx进去的字段\r\n    if (arr.hasOwnProperty(i)) {\r\n      let value = '';\r\n      if (Object.prototype.toString.call(jsonObj[arr[i]]) === '[object Object]') {\r\n        value = JSON.stringify(jsonObj[arr[i]]);\r\n      } else {\r\n        value = jsonObj[arr[i]];\r\n      }\r\n      str += arr[i] + '=' + value + '&';\r\n    }\r\n  }\r\n  return str.substr(0, str.length - 1);\r\n}\r\ninterface IStorageConfig {\r\n  /** 设置失效时间ms */\r\n  expires?: number;\r\n}\r\nfunction setStorage(key, value: any, config: IStorageConfig = {}) {\r\n  const { expires = 0 } = config;\r\n  if (expires > 0) {\r\n    console.log('设置setStorage', {\r\n      __expires__: expires + Date.now(),\r\n      __data__: value,\r\n    });\r\n\r\n    return wx.setStorageSync(key, {\r\n      __expires__: expires + Date.now(),\r\n      __data__: value,\r\n    });\r\n  }\r\n  return wx.setStorageSync(key, value);\r\n}\r\nfunction removeStorage(key) {\r\n  return wx.removeStorageSync(key);\r\n}\r\nfunction getStorage(key) {\r\n  let msg = wx.getStorageSync(key);\r\n  /** fix旧版本token处理 */\r\n  if (key === 'token' && typeof msg === 'string') {\r\n    const tokenExpireTime = wx.getStorageSync('token_expire_time');\r\n    if (tokenExpireTime) {\r\n      msg = ''; // 过期了\r\n      console.log('旧方案token删除掉重新登录');\r\n      removeStorage('token_expire_time');\r\n      removeStorage('token');\r\n      return msg;\r\n    }\r\n  }\r\n  if (msg.__expires__) {\r\n    if (msg.__expires__ > Date.now()) {\r\n      return msg.__data__;\r\n    } else {\r\n      removeStorage(key); // 过期了，清除掉\r\n      return ''; // getStorageSync拿不到默认返回''\r\n    }\r\n  } else {\r\n    return msg;\r\n  }\r\n}\r\n\r\n/**\r\n * 获取系统信息\r\n */\r\nfunction getPlatformInfo() {\r\n  const platform = wx.getSystemInfoSync();\r\n  if (platform.model.includes('iPhone')) {\r\n    platform.titleBarHeight = 44;\r\n  } else {\r\n    platform.titleBarHeight = 48;\r\n  }\r\n  platform.statusBarHeight = platform.statusBarHeight || 30;\r\n  platform.navHeight = platform.titleBarHeight + platform.statusBarHeight;\r\n  // iPhone X、iPhone XS\r\n  const isIPhoneX =\r\n    /iphone/.test(platform.model.toLocaleLowerCase()) && Number(platform.screenWidth) == 375 && Number(platform.screenHeight) == 812;\r\n  // iPhone XS Max\r\n  const isIPhoneXSMax =\r\n    /iphone/.test(platform.model.toLocaleLowerCase()) && Number(platform.screenWidth) == 414 && Number(platform.screenHeight) == 896;\r\n  // iPhone XR\r\n  const isIPhoneXR =\r\n    /iphone/.test(platform.model.toLocaleLowerCase()) && Number(platform.screenWidth) == 414 && Number(platform.screenHeight) == 896;\r\n  if (isIPhoneX || isIPhoneXSMax || isIPhoneXR) {\r\n    platform.isIphoneX = true;\r\n  }\r\n  console.log('platform', platform);\r\n  return platform;\r\n}\r\n\r\nfunction getApiUrl(url?: string) {\r\n  if (!url) return url;\r\n  try {\r\n    const index = url!.lastIndexOf('/');\r\n    const api = url!.substring(index + 1, url.length);\r\n    return api;\r\n  } catch (error) {\r\n    console.error('getApiUrl error', error);\r\n    return '';\r\n  }\r\n}\r\nfunction fetchError(res: AxiosResponse<any>, api: string | undefined, data: any) {\r\n  console.error(`http_then ${res.config.url} `, {\r\n    config: {\r\n      baseUrl: res?.config?.baseURL,\r\n      url: api || '',\r\n      method: res?.config?.method,\r\n      data: res?.config?.data,\r\n    },\r\n    data,\r\n    message: res.data?.message,\r\n    code: res.data?.code,\r\n    now_ts: res.data?.now_ts,\r\n  });\r\n}\r\nfunction fetchSuccess(res: AxiosResponse<any>, api: string | undefined) {\r\n  // console.report(`http_then ${res.config.url} `, {\r\n  //   config: {\r\n  //     baseUrl: res?.config?.baseURL,\r\n  //     url: api || '',\r\n  //     method: res?.config?.method,\r\n  //     data: res?.config?.data,\r\n  //   },\r\n  //   data: '响应数据从后端抓取',\r\n  //   message: res.data?.message,\r\n  //   code: res.data?.code,\r\n  //   now_ts: res.data?.now_ts,\r\n  // });\r\n}\r\n\r\nfunction httpRequestHandler(config: AxiosRequestConfig) {\r\n  const method = config.method;\r\n  const token = getStorage('token');\r\n  const account = getStorage('account');\r\n  config.headers = {\r\n    // 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n    'Content-Type': 'application/json; charset=UTF-8',\r\n    Accept: 'application/json, text/javascript, */*',\r\n    ...config.headers,\r\n    AUTHORIZATION: token,\r\n    account_id: account?.id ?? '',\r\n  };\r\n  if (config.method === 'get') {\r\n    if (!config.params) config.params = {};\r\n    config.params.token = token;\r\n    if (config.url?.includes('get_robot_accounts')) {\r\n      // 写死token\r\n      const freeToken = token || 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MTA3NTk1ODYxfQ.ON9D06DRTEFNbq7vXyvAdDJ388tHyu1TDNiaTf2b5Yo';\r\n      config.params.token = freeToken;\r\n      config.headers.AUTHORIZATION = freeToken;\r\n    }\r\n  } else if (config.method === 'post') {\r\n    if (!config.data) config.data = {};\r\n    // post请求在链接上加token\r\n    const hashmarkIndex = config.url?.indexOf('#');\r\n    if (hashmarkIndex !== -1) {\r\n      config.url = config.url?.slice(0, hashmarkIndex);\r\n    }\r\n    if (!config.url?.includes('weixin_mina')) {\r\n      config.url += (config.url?.indexOf('?') === -1 ? '?' : '&') + `token=${token}`;\r\n    }\r\n  }\r\n  const contentType: string = config.headers['Content-Type'] || config.headers['content-type'];\r\n  if (contentType.includes('application/x-www-form-urlencoded')) {\r\n    if (method === 'post') {\r\n      config.data = qs.stringify(config.data);\r\n    }\r\n  }\r\n}\r\n/**\r\n * 秒转时间\r\n * @param {*} val 秒数\r\n * @param {*} type 'hms'返回时分秒 | 'ms'分秒 | 's'秒\r\n */\r\nfunction secondToDate(val, type?: 'hms' | 'ms' | 's') {\r\n  let h = Math.floor(val / 3600).toString();\r\n  let m = Math.floor((val / 60) % 60).toString();\r\n  let s = Math.floor(val % 60).toString();\r\n  h = h.length < 2 ? `0${h}` : h;\r\n  m = m.length < 2 ? `0${m}` : m;\r\n  s = s.length < 2 ? `0${s}` : s;\r\n  switch (type) {\r\n    case 'hms':\r\n      return h + ':' + m + ':' + s;\r\n    case 'ms':\r\n      return m + ':' + s;\r\n    case 's':\r\n      return s;\r\n    default:\r\n      return m + ':' + s;\r\n  }\r\n}\r\n/** 字符串去除空格等 */\r\nfunction trim(str): string {\r\n  return str.replace(/^\\s+|\\s+$/g, '');\r\n}\r\nfunction dateFormat(data, mask, utc?): string {\r\n  return dateFormatPlugin(data, mask, utc);\r\n}\r\n/**\r\n * 时间戳转换\r\n * @param timestamp 时间戳\r\n * @param type  转换类型\r\n * @param connector 连接方式\r\n * @returns\r\n */\r\nfunction timeStream(timestamp: number, type?: string, connector = '-') {\r\n  const date: Date = new Date(timestamp);\r\n  const Y = date.getFullYear();\r\n  const M = date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;\r\n  const D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\r\n  const h = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();\r\n  const m = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();\r\n  const s = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();\r\n  const nowTime: Date = new Date();\r\n  const timeToString = nowTime.toString();\r\n  switch (type) {\r\n    // 年-月-日\r\n    case 'YMD':\r\n      return `${Y}${connector}${M}${connector}${D}`;\r\n    // 月-日\r\n    case 'MD':\r\n      return `${M}${connector}${D}`;\r\n    // 月-日 时：分\r\n    case 'MD_HM':\r\n      return `${M}${connector}${D} ${h}:${m}`;\r\n    // 月-日 时：分：秒\r\n    case 'YMD_HMS':\r\n      return `${Y}${connector}${M}${connector}${D} ${h}:${m}:${s}`;\r\n    // x年x月x日\r\n    case 'CN_YMD':\r\n      return `${Y}年${M}月${D}日`;\r\n    // x年x月x日 时：分\r\n    case 'CN_YMD_HM':\r\n      return `${Y}年${M}月${D}日 ${h}:${m}`;\r\n    // x月x日\r\n    case 'CN_MD':\r\n      return `${M}月${D}日`;\r\n    // x月x日 时：分\r\n    case 'CN_MD_HM':\r\n      return `${M}月${D}日 ${h}:${m}`;\r\n    // 时:分\r\n    case 'hm':\r\n      return `${h}:${m}`;\r\n    // 天数差\r\n    case '-D':\r\n      return Math.floor((timestamp * 1000 - Date.parse(timeToString)) / 1000 / 3600 / 24);\r\n    // 小时差\r\n    case '-H':\r\n      return Math.ceil((timestamp * 1000 - Date.parse(timeToString)) / 1000 / 3600);\r\n    case 'standard':\r\n      return `${Y}${connector}${M}${connector}${D} ${h}:${m}:${s}`;\r\n\r\n    default:\r\n      // 年-月-日 时:分\r\n      return `${Y}${connector}${M}${connector}${D} ${h}:${m}`;\r\n  }\r\n}\r\nfunction isIos(): boolean {\r\n  const system = wx.getPlatform().system;\r\n  return /ios/gi.test(system);\r\n}\r\n/** 获取音频进度设置的响应实践，每种机型都不同 */\r\nfunction getAudioResTime() {\r\n  const ios = isIos();\r\n  let phoneLevel = 30; // 机器性能越大越强\r\n  if (wx.getPlatform().brand !== 'devtools') {\r\n    phoneLevel = wx.getSystemInfoSync().benchmarkLevel;\r\n  }\r\n  let duration = 100;\r\n  // ios的延迟是100，机子越垃圾，延迟越大\r\n  if (!ios) {\r\n    if (phoneLevel >= 30) {\r\n      duration = 300;\r\n    } else if (phoneLevel >= 25) {\r\n      duration = 400;\r\n    } else if (phoneLevel >= 15) {\r\n      duration = 700;\r\n    } else if (phoneLevel >= 10) {\r\n      duration = 800;\r\n    } else {\r\n      duration = 1000;\r\n    }\r\n    console.log(duration);\r\n  } else {\r\n    if (phoneLevel >= 30) {\r\n      duration = 100;\r\n    } else {\r\n      duration = 200;\r\n    }\r\n  }\r\n  return duration;\r\n}\r\n/** 由于后端偷懒没整合数据 前端做 TODO 后端优化 */\r\nfunction handleChannelContent(content: IChannelDailyContentGet.data) {\r\n  try {\r\n    content.fomate_daily_content.forEach((item) => {\r\n      const books: IChannelDailyContentGet.DailyBooks[] = [];\r\n      item.content.forEach((lecture) => {\r\n        if (lecture.object_type === 'lecture') {\r\n          const index = books.findIndex((book) => book.id === lecture.book_id);\r\n          if (index === -1) {\r\n            books.push({\r\n              ...content.book_content[lecture.book_id],\r\n              lectures: [lecture],\r\n            });\r\n          } else {\r\n            books[index].lectures.push(lecture);\r\n          }\r\n        } else {\r\n          books.length && (item.exam = lecture);\r\n        }\r\n      });\r\n      item.books = books;\r\n    });\r\n  } catch (error) {\r\n    console.error(content);\r\n  }\r\n  return content;\r\n}\r\n\r\n/**\r\n * 获取url 最后一个/到?开头的数据\r\n * @param url\r\n */\r\nfunction getUrlApiName(url: string | undefined) {\r\n  try {\r\n    return url?.match(/[^\\/]+?(?=\\?|$)/)?.[0] ?? url;\r\n  } catch (error) {\r\n    console.warn(error);\r\n    return url;\r\n  }\r\n}\r\n\r\nconst EntryTypeArray = [\r\n  'home', //首页分享\r\n  'clock', //打卡转发\r\n  'clock_qrcode', //打卡图片里面的二维码 TODO 待配置\r\n  'share_book', //分享好书\r\n  'exam', //周测转发\r\n  'exam_qrcode', //周测分享图 TODO 待配置\r\n  'friend', //亲友卡\r\n] as const;\r\ntype EntryType = typeof EntryTypeArray[number];\r\n\r\n/**\r\n * 获取入口路径\r\n * @returns\r\n * ```\r\n * from: 分享来源(key)\r\n * home   首页分享\r\n * clock  打卡转发\r\n * clock_qrcode 打卡图片里面的二维码 TODO 待配置\r\n * share_book 分享好书\r\n * exam   周测转发\r\n * exam_qrcode  周测分享图 TODO 待配置\r\n * friend 亲友卡\r\n * ```\r\n */\r\nfunction getEntry(): EntryType {\r\n  const pages = getCurrentPages();\r\n  const root = pages?.[0].options?.from ?? 'home';\r\n  console.log('root', root);\r\n\r\n  return root as EntryType;\r\n}\r\n\r\nfunction safeBottom() {\r\n  let res = wx.getSystemInfoSync();\r\n  return res.screenHeight - res.safeArea.bottom;\r\n}\r\n/**\r\n * @description: 是否关注公众号\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst checkHasSubscribed = async () => {\r\n  const subscribe = wx.getStorageSync('setIsSubscribe') ? JSON.parse(Taro.getStorageSync('setIsSubscribe')) : false;\r\n  if (subscribe) return subscribe;\r\n  const account_id = Number(wx.getStorageSync('account').id ?? '');\r\n  try {\r\n    const res = await api_judge_subscribed(account_id);\r\n    if (res) {\r\n      wx.setStorageSync('setIsSubscribe', res.is_subscribed);\r\n      return res.is_subscribed;\r\n    }\r\n  } catch (error) {\r\n    console.error('api_judge_subscribed error', error);\r\n  }\r\n};\r\n\r\n/**\r\n * @description: 图片质量压缩\r\n * @param {string} url 图片链接\r\n * @param {number} width 限定缩略图的宽最多为width\r\n * @param {string} format 新图的输出格式\r\n * @param {number} quality 新图的图片质量<取值范围是[1, 100]，默认75。>\r\n * @decs https://developer.qiniu.com/dora/api/basic-processing-images-imageview2\r\n */\r\nfunction getPicture(url: string, width: number = 300, format: string = 'normal', quality: number = 85) {\r\n  if (format === 'webp') {\r\n    return `${url}?imageView2/format/webp/2/w/${width}/q/${quality}!`;\r\n  } else {\r\n    return `${url}?imageView2/2/w/${width}/q/${quality}!`;\r\n  }\r\n}\r\nexport {\r\n  getPicture,\r\n  getEntry,\r\n  getUrlApiName,\r\n  handleChannelContent,\r\n  getAudioResTime,\r\n  isIos,\r\n  dateFormat,\r\n  trim,\r\n  secondToDate,\r\n  httpRequestHandler,\r\n  fetchError,\r\n  fetchSuccess,\r\n  getApiUrl,\r\n  getPlatformInfo,\r\n  getStorage,\r\n  removeStorage,\r\n  setStorage,\r\n  jsonSort,\r\n  throttle,\r\n  debounce,\r\n  getActivePage,\r\n  timeStream,\r\n  safeBottom,\r\n};\r\n","/*\r\n * @Description: 埋点\r\n * @Date: 2021-08-26 16:00:12\r\n * @LastEditTime: 2021-09-14 17:25:27\r\n */\r\nimport { getToken } from '@/utils/login';\r\nimport TorDataService from '@weike/mp-earth';\r\nimport { getEntry, getStorage } from '@/utils/tools';\r\nimport { ApiStore } from '@/store';\r\n\r\nclass Track {\r\n  private isInit = false;\r\n  private torDataService: any = null;\r\n\r\n  getTorDataService() {\r\n    return this.torDataService;\r\n  }\r\n\r\n  setTorDataService(torDataService) {\r\n    this.torDataService = torDataService;\r\n  }\r\n\r\n  // 玄武埋点初始化\r\n  initEvent() {\r\n    if (this.isInit) return console.log('玄武已初始化');\r\n    getToken(\r\n      () => {\r\n        console.log('*******埋点初始化******');\r\n        try {\r\n          const id = getStorage('account').id;\r\n          TorDataService.init(id, 'weike', 'wk.lhm001a.df0.d00a', {\r\n            version: 'v1',\r\n          });\r\n          this.setTorDataService(TorDataService);\r\n          this.isInit = true;\r\n        } catch (err) {\r\n          console.error('玄武埋点初始化失败');\r\n        }\r\n      },\r\n      () => {}\r\n    );\r\n  }\r\n\r\n  setEvent(evt, params?) {\r\n    if (this.torDataService) {\r\n      try {\r\n        this.torDataService.emitAction(evt, {\r\n          ...params,\r\n          user_type: ApiStore.user.userType,\r\n          from_page: getEntry(),\r\n        });\r\n      } catch (e) {\r\n        console.log('setEvent', e);\r\n      }\r\n    } else {\r\n      setTimeout(() => {\r\n        this.setEvent(evt, params);\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.torDataService && this.torDataService.destroy();\r\n  }\r\n}\r\n\r\nexport const track = new Track();\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AADA;AACA;AAGA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACnCA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AADA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAUA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AADA;AAGA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;;;;;;;;;;;ACdA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AAEA;;;AASA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAJA;AASA;AACA;AAAA;;;;;;;;;;;ACrCA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAaA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AADA;AAIA;AAAA;AAAA;AAAA;AAAA;AALA;AAUA;AACA;AACA;AAAA;;;;;;;;;;;;ACpCA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAOA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;;;;;;;;;;AC3BA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AAUA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAJA;AAUA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAbA;AAoBA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AALA;AAvBA;AAiCA;AACA;AACA;AACA;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAEA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AALA;AASA;AAAA;AAVA;AAaA;AACA;AAAA;AACA;AADA;AAGA;;;;;;;;;;;;ACnCA;AACA;;;;;;;;;;;ACDA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;AAOA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AAEA;AAHA;AACA;AADA;AAMA;AANA;AAAA;AAAA;AACA;AADA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAbA;AAAA;AACA;AADA;AAAA;AAAA;AAcA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAkBA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAcA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AAIA;AALA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAbA;AAAA;AACA;AADA;AAAA;AAAA;AAcA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAHA;AAEA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AATA;AAAA;AACA;AADA;AAAA;AAAA;AAUA;AACA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AAXA;AAaA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AAXA;AAaA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AADA;AAOA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAEA;AAAA;AAAA;AALA;AASA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAKA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAAA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AADA;AAIA;AAAA;AAVA;AAgBA;AAAA;AAAA;AAlBA;AAuBA;AAAA;AAAA;AAMA;AAEA;AAEA;AACA;AACA;AALA;AAQA;AACA;AAFA;AAAA;AAMA;AAAA;AAAA;AAIA;AAAA;AACA;AAAA;AADA;AAIA;AAAA;AACA;AAAA;AADA;AAIA;AACA;AAAA;AADA;AAzBA;AAiCA;AAjEA;AANA;AADA;AA6EA;AAxFA;AADA;AA6FA;AAhGA;AAlBA;AAsHA;AAAA;AAxHA;AA4HA;AACA;AACA;;;;;;;;;;;;ACxYA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAOA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAKA;;;;;;;;;;;;ACrBA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AADA;AAIA;AACA;AAAA;;;;;;;;;;;;AChBA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAkBA;;;;;;;;;;;;;;;;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAHA;AACA;AASA;AACA;AACA;AACA;;;;;;;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;AAQA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAFA;AASA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AADA;AAFA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAjBA;AADA;AAyBA;;;;AA/CA;AACA;AAgDA;;;;;;;;;;;AC5EA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AALA;AADA;AAUA;AAAA;AAdA;AAkBA;AACA;;;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BA;AACA;AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AACA;AAeA;AACA;AAgBA;AACA;AAlBA;AACA;AA8CA;;;;;;;;;;;;;;;;;;;;;;;AC9JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AAbA;AACA;AAAA;AACA;AACA;AAJA;AACA;AAcA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;;;;;;AAGA;;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAeA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AA0CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAMA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA3CA;AA8KA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxMA;AAsWA;AACA;AACA;AACA;AACA;AA1WA;AAAA;AA0WA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA3WA;AAAA;AAAA;AAAA;AACA;AADA;AAiZA;AACA;AACA;AACA;AAAA;AACA;AACA;AAtZA;AAyZA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhbA;AAybA;AACA;AACA;AACA;AA3bA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAeA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AASA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAAA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AA4BA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AAAA;AACA;AAAA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AA5DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;AA6EA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;;;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AA8CA;;;;;;;;;;;;;;;;;;;;;AC5fA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AADA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;;;;;;AAGA;;;;;;;;;;;;;;;;;;;;;;AC9BA;AACA;AACA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAyJA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AACA;AApLA;AA2LA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;AA9MA;AAmNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AA9NA;AAqOA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AAvPA;AA6PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AAxQA;AACA;AADA;AAAA;AAAA;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;AAAA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AA1BA;AAAA;AAAA;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAVA;AAYA;AACA;AA1CA;AAAA;AAAA;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAVA;AAYA;AACA;AA1DA;AAAA;AAAA;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AACA;AACA;AACA;AA3EA;AAAA;AAAA;AA4EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5FA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AA8FA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAlHA;AAAA;AAAA;AAAA;AAoHA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;AACA;AACA;AApIA;AAAA;AAAA;AAqIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxJA;AAAA;AAAA;AAyQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAdA;AAgBA;AACA;AAtBA;AAwBA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAjCA;AAmCA;AAxCA;AA0CA;AACA;AACA;AACA;AAzTA;AAAA;AAAA;AA0TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAlWA;AAAA;AAAA;AAoWA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAPA;AASA;AAjBA;AAmBA;AA7BA;AA+BA;AACA;AACA;AACA;AArCA;AAuCA;AA5YA;AACA;AADA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;ACCA;AACA;AACA;AACA;AACA;AAYA;AAIA;AAEA;AAEA;AAEA;AAAA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AACA;AADA;AAsGA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAhHA;AAgHA;AAAA;AACA;AAjHA;AAiHA;AAAA;AACA;AAlHA;AAkHA;AAAA;AACA;AAnHA;AAmHA;AAAA;AACA;AApHA;AAoHA;AAAA;AACA;AArHA;AAqHA;AAAA;AACA;AAtHA;AAsHA;AAAA;AACA;AAvHA;AAuHA;AAAA;AACA;AAxHA;AAwHA;AAAA;AACA;AAzHA;AAyHA;AAAA;AACA;AA1HA;AA0HA;AAAA;AACA;AA3HA;AA2HA;AAAA;AACA;AA3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAaA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;;;;AAGA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;;AAsBA;AACA;AAwJA;AACA;AAoBA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;AA/QA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAHA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AASA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AA7MA;AACA;AA0RA;;;;;;;;;;;;;AC5eA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAWA;AACA;AAAA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAPA;AAUA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzFA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AAiCA;AACA;;AAlCA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAIA;AAAA;AAAA;AACA;AALA;AAKA;AACA;AACA;AAPA;AAAA;AACA;AADA;AAQA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AA7BA;AAAA;AACA;AADA;AAAA;AAAA;AA8BA;AACA;AA/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAkCA;AAAA;AAAA;AACA;;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;AACA;AAXA;AAAA;AACA;AADA;AAWA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAnBA;AACA;AADA;AAAA;AAAA;AAqBA;AACA;AACA;AACA;AAFA;AAtBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AACA;AACA;AAEA;AACA;AAyBA;;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvBA;;;;;AA0BA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AAbA;AACA;AAAA;AAAA;AAaA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3FA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAUA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAVA;AAYA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AANA;AACA;AAOA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AARA;AAUA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAvCA;AAyCA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAGA;AAHA;AAAA;AAAA;AACA;AADA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AACA;AAMA;AAPA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAWA;AACA;AAZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AACA;AAAA;;;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;;;;AAGA;;;;A","sourceRoot":""}