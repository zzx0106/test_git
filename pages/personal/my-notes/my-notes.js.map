{"version":3,"file":"pages/personal/my-notes/my-notes.js","sources":["webpack:///._src_pages_personal_my-notes_my-notes.tsx","webpack:///._src_pages_personal_my-notes_my-notes.module.scss","webpack:///._src_pages_personal_my-notes_my-notes.scss","webpack:///./src/pages/personal/my-notes/my-notes.tsx?7947"],"sourcesContent":["/*\r\n * @Description: 我的笔记\r\n * @Date: 2021-08-23 16:40:08\r\n * @LastEditTime: 2021-09-03 15:32:22\r\n */\r\nimport { View, ScrollView, Text, Image } from '@tarojs/components';\r\nimport React, { useState, useEffect } from 'react';\r\nimport Taro from '@tarojs/taro';\r\nimport { api_personal_discuss } from '@/api/personal_center/personal_center';\r\nimport { IMyNotes } from '@/api/personal_center/personal_center.i';\r\nimport Loading from '@/components/loading/loading';\r\nimport { timeStream } from '@/utils/tools';\r\nimport style from './my-notes.module.scss';\r\nimport './my-notes.scss';\r\nimport Empty from '@/components/empty/empty';\r\nimport LoadMore from '@/components/load-more/load-more';\r\n\r\nconst MyNotes = () => {\r\n  let [personal_discuss_list, setPersonal_discuss_list] = useState<IMyNotes.PersonalDiscussList[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  let [page, setPage] = useState(1);\r\n  const [is_last_page, setIsLastPage] = useState(false);\r\n  const [is_load_interface, setIsLoadInterface] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getPersonalDiscuss();\r\n  }, []);\r\n\r\n  const getPersonalDiscuss = async () => {\r\n    try {\r\n      const res = await api_personal_discuss(page);\r\n      if (res) {\r\n        let list: IMyNotes.PersonalDiscussList[] = [...personal_discuss_list, ...res.personal_discuss_list];\r\n        list.forEach((item) => {\r\n          item.noMore = item.noMore || false;\r\n        });\r\n        setPersonal_discuss_list([...list]);\r\n        setIsLastPage(res.is_last_page);\r\n        setIsLoadInterface(false);\r\n        getNotesHeight([...list]);\r\n      }\r\n    } catch (error) {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 上拉加载数据\r\n  const nextDataPage = () => {\r\n    if (is_load_interface || is_last_page) return;\r\n    setIsLoadInterface(true);\r\n    page = page * 1 + 1;\r\n    setPage(page);\r\n    getPersonalDiscuss();\r\n  };\r\n\r\n  const bindRoute = (object_id: number) => {\r\n    Taro.navigateTo({\r\n      url: `/pages/detail/detail?object_id=${object_id}`,\r\n    });\r\n  };\r\n\r\n  // 显示更多\r\n  const bindShowMore = (id: number) => {\r\n    personal_discuss_list.forEach((item) => {\r\n      if (id === item.id) {\r\n        item.noMore = !item.noMore;\r\n      }\r\n    });\r\n    setPersonal_discuss_list([...personal_discuss_list]);\r\n  };\r\n\r\n  /**\r\n   * 获取content 内容高度来判断是否显示 查看更多\r\n   * @param list 列表数据\r\n   */\r\n  const getNotesHeight = (list: IMyNotes.PersonalDiscussList[]) => {\r\n    setTimeout(() => {\r\n      const query = Taro.createSelectorQuery();\r\n      query\r\n        .selectAll('.note-info')\r\n        .boundingClientRect(function (rect) {\r\n          list.forEach((item, index) => {\r\n            //已渲染过的html重新计算高度有问题全<=48\r\n            if (!item.height) {\r\n              item.height = rect[index].height;\r\n            }\r\n          });\r\n          setPersonal_discuss_list([...list]);\r\n          setLoading(false);\r\n        })\r\n        .exec();\r\n    }, 50);\r\n  };\r\n  return (\r\n    <>\r\n      {loading && <Loading />}\r\n      {/* 这块做opacity的样式处理而不用三元运算是为了在初始化的时候能拿到 content 内容的高度*/}\r\n      <View style={{ opacity: !loading ? '1' : '0' }}>\r\n        <ScrollView className={style.scroll_view_container} scrollY onScrollToLower={nextDataPage}>\r\n          <View className={style.my_notes_container}>\r\n            {personal_discuss_list.map((item, index) => {\r\n              return (\r\n                <View className={style.item_content} key={index}>\r\n                  <View className={style.item_header} onClick={() => bindRoute(item.object_id)}>\r\n                    <View className={style.flex}>\r\n                      <View className={style.flex}>\r\n                        <View className={style.title}>{item.channel_name}</View>\r\n                        <Text className=\"icon icon-gerenzhongxinjiantou1x\"></Text>\r\n                      </View>\r\n                      <View className={style.light_text}>{timeStream(item.create_ts * 1000, 'CN_YMD')}</View>\r\n                    </View>\r\n                    <View className={style.light_text}>{item.book_name}</View>\r\n                  </View>\r\n                  {/* 判断高度48的由来是设置了line-height */}\r\n                  <View\r\n                    className={`'note-info' ${item.height && item.height > 48 ? 'note-info-hide' : ''}`}\r\n                    style={{ display: item.noMore ? 'block' : '-webkit-box', lineHeight: '24px' }}>\r\n                    {item.content}\r\n                  </View>\r\n                  {item.height && item.height > 48 && (\r\n                    <View className={style.footer_more} onClick={() => bindShowMore(item.id)}>\r\n                      <Text>{item.noMore ? '收起' : '查看更多'}</Text>\r\n                      <Image\r\n                        className={`${style.arrow_down} ${item.noMore ? style.rote : ''}`}\r\n                        src=\"https://static-1253442168.file.myqcloud.com/xupload/20210608_down.png\"></Image>\r\n                    </View>\r\n                  )}\r\n                </View>\r\n              );\r\n            })}\r\n          </View>\r\n          {!personal_discuss_list.length ? <Empty /> : <LoadMore is_last_page={is_last_page} />}\r\n        </ScrollView>\r\n      </View>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MyNotes;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"scroll_view_container\":\"scroll_view_container--3orV0\",\"my_notes_container\":\"my_notes_container--3WzSN\",\"item_content\":\"item_content--Ov09j\",\"item_header\":\"item_header--21ix5\",\"icon-gengduo\":\"icon-gengduo--3gWF7\",\"flex\":\"flex--22mV6\",\"title\":\"title--248R8\",\"light_text\":\"light_text--1KxRX\",\"note_info\":\"note_info--22E7o\",\"note_info_hide\":\"note_info_hide--2WxdG\",\"footer_more\":\"footer_more--3zMKF\",\"rote\":\"rote--_-i9a\",\"arrow_down\":\"arrow_down--W2vCp\",\"bottom_line\":\"bottom_line--3zFfV\"};","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../node_modules/babel-loader/lib/index.js!./my-notes.tsx\"\nvar config = {\"navigationBarTitleText\":\"我的笔记\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/personal/my-notes/my-notes', {root:{cn:[]}}, config || {}))\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;AACA;AADA;AAAA;AAAA;AAcA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAXA;AACA;AACA;AA4BA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AACA;AADA;AAvCA;AACA;AACA;AA2CA;AACA;AACA;AACA;AACA;AAHA;AAKA;AANA;AASA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAVA;AAFA;AADA;AACA;AAiBA;AACA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAFA;AAIA;AAAA;AAAA;AALA;AAOA;AAAA;AAAA;AARA;AAYA;AACA;AAAA;AAAA;AAAA;AAFA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAFA;AAFA;AAlBA;AAFA;AADA;AAgCA;AAAA;AAjCA;AADA;AAHA;AA7EA;AACA;AAwHA;;;;;;;;;;;;AC1IA;AACA;;;;;;;;;;;ACDA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}