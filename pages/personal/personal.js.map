{"version":3,"file":"pages/personal/personal.js","sources":["webpack:///._src_pages_personal_personal.tsx","webpack:///._src_pages_personal_components_dia-tip_dia-tip.module.scss","webpack:///._src_pages_personal_components_dia-tip_dia-tip.tsx","webpack:///._src_pages_personal_components_panel_panel.module.scss","webpack:///._src_pages_personal_components_panel_panel.tsx","webpack:///._src_pages_personal_personal.module.scss","webpack:///./src/pages/personal/personal.tsx?e9b6"],"sourcesContent":["/*\r\n * @Description: 个人中心\r\n * @Date: 2021-08-24 16:33:09\r\n * @LastEditTime: 2021-09-08 18:36:00\r\n */\r\nimport React, { useMemo, useState } from 'react';\r\nimport style from './personal.module.scss';\r\nimport { View, Button, Image } from '@tarojs/components';\r\nimport Taro, { useDidHide, useDidShow, useTabItemTap } from '@tarojs/taro';\r\nimport Loading from '@/components/loading/loading';\r\nimport { getToken, httpCheckLogin } from '@/utils/login';\r\nimport { api_user_infomation } from '@/api/personal_center/personal_center';\r\nimport { IPersonal } from '@/api/personal_center/personal_center.i';\r\nimport PersonalPanel from './components/panel/panel';\r\nimport PersonalDiaTip from './components/dia-tip/dia-tip';\r\nimport PlayerFloat from '@/components/player-float/player-float';\r\n\r\nconst Personal = () => {\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [has_join, setHasJoin] = useState<boolean>(true);\r\n  const [bought_channel_num, setBoughtChannelNum] = useState<number>(0);\r\n  const [account_info, setAccountInfo] = useState<IPersonal.AccountInfo>();\r\n  const [credits_num, setCreditsNum] = useState<number>(0);\r\n  const [discuss_num, setDiscussNum] = useState<number>(0);\r\n  const [quotes, setQuotes] = useState<string>('');\r\n\r\n  const [show_tip, setShowTip] = useState<boolean>(false);\r\n  const [is_disabled, setIsDisabled] = useState<boolean>(false);\r\n\r\n  useTabItemTap((item) => {\r\n    handleIsNewUser();\r\n  });\r\n\r\n  const handleIsNewUser = () => {\r\n    getToken(\r\n      () => {\r\n        getUserCenter();\r\n      },\r\n      () => {\r\n        setLoading(false);\r\n        setHasJoin(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  const getUserCenter = async () => {\r\n    try {\r\n      const res = await api_user_infomation();\r\n      if (res) {\r\n        Taro.setStorageSync('setWithdrawIng', res.withdraw_ing);\r\n        setBoughtChannelNum(res.bought_channel_num);\r\n        setAccountInfo(res.account_info);\r\n        setCreditsNum(res.credits_num);\r\n        setDiscussNum(res.discuss_num);\r\n        setQuotes(res.quotes);\r\n        setLoading(false);\r\n        setHasJoin(true);\r\n\r\n        // 付费用户和使试用7天用户人群需要显示温馨提示\r\n        if (res.access_info.pay_fee || res.access_info.trial_day) {\r\n          const now = new Date().getTime();\r\n          const expire = new Date('2021-09-05 00:00:00').getTime(); // 截至9.5.00.00.00\r\n          setShowTip(now < expire ? true : false);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const bindJoin = () => {\r\n    if (has_join) return;\r\n    if (!is_disabled) {\r\n      setIsDisabled(true);\r\n      getUserProfile();\r\n    } else {\r\n      Taro.showToast({\r\n        title: '操作太快啦！',\r\n        icon: 'none',\r\n        mask: true,\r\n      });\r\n    }\r\n    setTimeout(() => {\r\n      setIsDisabled(false);\r\n    }, 500);\r\n  };\r\n\r\n  const getUserProfile = () => {\r\n    Taro.getUserProfile({\r\n      desc: '用于用户身份辨别',\r\n      success: (res) => {\r\n        getCheckLogin(res);\r\n      },\r\n      fail: (err) => {\r\n        console.log('授权失败：', err);\r\n      },\r\n    });\r\n  };\r\n\r\n  const getCheckLogin = async (res) => {\r\n    const params = {\r\n      encryptedData: res.encryptedData,\r\n      iv: res.iv,\r\n    };\r\n    try {\r\n      await httpCheckLogin(params);\r\n      getUserCenter();\r\n    } catch (error) {\r\n      console.error('getCheckLogin error', error);\r\n    }\r\n  };\r\n\r\n  const bindRoute = (url: string) => {\r\n    if (!has_join) {\r\n      bindJoin();\r\n      return;\r\n    }\r\n    Taro.navigateTo({\r\n      url,\r\n    });\r\n  };\r\n\r\n  const getMenu = useMemo(() => {\r\n    const list = [\r\n      {\r\n        key: 'pay',\r\n        title: bought_channel_num + '套',\r\n        subtitle: '我的课程',\r\n        url: '/pages/personal/my-purchased/my-purchased',\r\n      },\r\n      {\r\n        key: 'note',\r\n        title: discuss_num + '篇',\r\n        subtitle: '读书笔记',\r\n        url: '/pages/personal/my-notes/my-notes',\r\n      },\r\n      {\r\n        key: 'num',\r\n        title: credits_num,\r\n        subtitle: '我的学分',\r\n        url: `/pages/personal/center-credit/center-credit?credits_num=${credits_num}&avatar=${account_info?.headimgurl}`,\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <View className={style.flex}>\r\n        {list.map((item) => {\r\n          return (\r\n            <View className={style.route_item} onClick={() => bindRoute(item.url)} key={item.key} hoverClass=\"hover-class\">\r\n              <View className={style.title}>{item.title}</View>\r\n              <View className={style.subtitle}>{item.subtitle}</View>\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }, [bought_channel_num, discuss_num, credits_num, account_info, has_join]);\r\n\r\n  return loading ? (\r\n    <Loading />\r\n  ) : (\r\n    <>\r\n      <View className={style.user_center_container}>\r\n        <View className={style.user_header_wrapper}>\r\n          <View className={`${style.basic_info} ${style.flex}`}>\r\n            <View className={style.flex} onClick={bindJoin} hoverClass={`${!has_join ? 'hover-class' : ''}`}>\r\n              <Image\r\n                className={style.avatar}\r\n                src={account_info?.headimgurl || 'https://static-1253442168.file.myqcloud.com/xupload/20210720_author.png'}></Image>\r\n              <View className=\"center\">\r\n                <View className={style.nickname}>{account_info?.nickname || '点击登录'}</View>\r\n                <View className={style.saying}>{quotes || '每天进步一点点'}</View>\r\n              </View>\r\n            </View>\r\n            <View\r\n              className={style.right_button}\r\n              onClick={() => bindRoute('/pages/personal/withdrawal/withdrawal')}\r\n              hoverClass=\"hover-class\">\r\n              余额提现\r\n            </View>\r\n          </View>\r\n          {getMenu}\r\n        </View>\r\n        <PersonalPanel />\r\n        {/* 提示弹窗 */}\r\n        <PersonalDiaTip show={show_tip} setShow={setShowTip} />\r\n        <PlayerFloat></PlayerFloat>\r\n      </View>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Personal;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"more_wrapper\":\"more_wrapper--3pRZY\",\"title\":\"title--2YBgm\",\"more_message\":\"more_message--JlXzl\",\"more_item\":\"more_item--13OXM\",\"more_btn\":\"more_btn--3Uxxm\"};","/*\r\n * @Description: tip弹窗\r\n * @Date: 2021-08-24 19:13:42\r\n * @LastEditTime: 2021-08-30 15:16:41\r\n */\r\n\r\nimport { View, Button } from '@tarojs/components';\r\nimport React from 'react';\r\nimport style from './dia-tip.module.scss';\r\nimport Taro from '@tarojs/taro';\r\nimport Dialog from '@/components/dialog/dialog';\r\n\r\ninterface IProp {\r\n  show: boolean;\r\n  setShow: Function;\r\n}\r\nconst PersonalDiaTip = (props: IProp) => {\r\n  const bindMore = () => {\r\n    Taro.navigateTo({\r\n      url: `/pages/h5/h5?webViewUrl=https://mp.weixin.qq.com/s/Ic-qij_XA3ZPUnUUHR88hg`,\r\n      complete: () => {\r\n        props.setShow(false);\r\n      },\r\n    });\r\n  };\r\n  console.log('PersonalDiaTip');\r\n  \r\n  return (\r\n    <Dialog value={props.show} setValue={props.setShow} showClose maskClose title=\"梨花小提示\" backgroundColor=\"#fff\">\r\n      <View className={style.more_wrapper}>\r\n        <View className={style.more_message}>\r\n          <View>亲爱的用户，你好呀！</View>\r\n          <View className={style.more_item}>我们又又又更新版本啦！</View>\r\n          <View className={style.more_item}>为了解决大部分用户听完书获取不到返现和学分的问题，现在我们只要打卡就能获得返现和学分啦！</View>\r\n          <View className={style.more_item}>听完书一定一定要记得打卡哦！</View>\r\n        </View>\r\n        <Button className={style.more_btn} onClick={bindMore} hoverClass=\"hover-class\">\r\n          点击查看详情\r\n        </Button>\r\n      </View>\r\n    </Dialog>\r\n  );\r\n};\r\nexport default PersonalDiaTip;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"custom_cells_wrapper\":\"custom_cells_wrapper--6_9TQ\",\"icon\":\"icon--3YGFr\",\"item_link\":\"item_link--3qgl0\",\"text\":\"text--ZvqsB\",\"icon_img\":\"icon_img--3qNOf\",\"flex\":\"flex--3aHVD\"};","/*\r\n * @Description: enter your description\r\n * @Date: 2021-08-24 19:09:50\r\n * @LastEditTime: 2021-08-27 11:31:23\r\n */\r\nimport { View, Text, Image } from '@tarojs/components';\r\nimport React from 'react';\r\nimport Taro from '@tarojs/taro';\r\nimport style from './panel.module.scss';\r\n\r\ninterface Iprop {}\r\n\r\nconst PersonalPanel = (props: Iprop) => {\r\n  const link_list = [\r\n    {\r\n      name: '关于梨花',\r\n      icon: 'icon-Coupons1x',\r\n      path: '/pages/h5/h5?webViewUrl=https://mp.weixin.qq.com/s/ldqriWkMOEBnffE8yGicZA',\r\n    },\r\n    {\r\n      name: '联系客服',\r\n      icon: 'icon-Remind1x',\r\n      path: '/pages/h5/h5?webViewUrl=https://mp.weixin.qq.com/s/HC9G70AEQoXz0xQmqC4WNA',\r\n    },\r\n    {\r\n      name: '投诉与建议',\r\n      icon: 'icon-Notes1x',\r\n      path: '/pages/h5/h5?webViewUrl=https://mp.weixin.qq.com/s/KP6dCksnMla-4QIKJyONFA',\r\n    },\r\n  ];\r\n  const bindRouteH5 = (url: string) => {\r\n    Taro.navigateTo({\r\n      url,\r\n    });\r\n  };\r\n  return (\r\n    <View className={style.custom_cells_wrapper}>\r\n      {link_list.map((item, index) => {\r\n        return (\r\n          <View className={style.route_item} key={index} onClick={() => bindRouteH5(item.path)} hoverClass=\"hover-class\">\r\n            <View className={`${style.flex} ${style.item_link}`}>\r\n              <View className={style.flex}>\r\n                <Text className={`icon ${style.icon} ${item.icon}`}></Text>\r\n                <Text className={style.text}>{item.name}</Text>\r\n              </View>\r\n              <Image className={style.icon_img} src=\"https://static-1253442168.file.myqcloud.com/xupload/20210624_icon.png\"></Image>\r\n            </View>\r\n          </View>\r\n        );\r\n      })}\r\n    </View>\r\n  );\r\n};\r\nexport default PersonalPanel;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"user_center_container\":\"user_center_container--340JN\",\"basic_info\":\"basic_info--2Liv9\",\"user_header_wrapper\":\"user_header_wrapper--15xaC\",\"avatar\":\"avatar--3j4zh\",\"nickname\":\"nickname--UYPAn\",\"saying\":\"saying--27xto\",\"right_button\":\"right_button--DnMkW\",\"flex\":\"flex--1ebTq\",\"title\":\"title--2oPlL\",\"subtitle\":\"subtitle--3zo_3\"};","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js!./personal.tsx\"\nvar config = {\"navigationBarTitleText\":\"个人中心\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/personal/personal', {root:{cn:[]}}, config || {}))\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AAEA;AAFA;AAKA;AACA;AANA;AADA;AACA;AAWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AApBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAwBA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AACA;AADA;AAZA;AACA;AAgBA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAPA;AADA;AACA;AAWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AADA;AAAA;AAAA;AACA;AADA;AAOA;AAPA;AAAA;AACA;AADA;AAAA;AAAA;AASA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAYA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AALA;AACA;AASA;AACA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAFA;AADA;AAvBA;AAoCA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAJA;AAUA;AACA;AAAA;AAFA;AAGA;AAHA;AAAA;AAVA;AADA;AAsBA;AAAA;AAAA;AAvBA;AADA;AAhJA;AACA;AA8KA;;;;;;;;;;;;AChMA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAJA;AAMA;AAAA;AAAA;AAAA;AAAA;AAPA;AADA;AAcA;AACA;AAAA;;;;;;;;;;;;AC3CA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAHA;AAMA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AALA;AADA;AAUA;AAbA;AAgBA;AACA;AAAA;;;;;;;;;;;;ACrDA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}